{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/map/map.css?b431","webpack:///external \"window.d3\"","webpack:///./src/components/map/links.tsx","webpack:///./src/utils.ts","webpack:///./src/types.ts","webpack:///./src/components/map/nodes.tsx","webpack:///./src/components/map/consts.ts","webpack:///./src/components/map/tooltip.tsx","webpack:///./src/legacy-actions.ts","webpack:///./src/websocket.ts","webpack:///./src/actions.ts","webpack:///./src/components/map/index.tsx","webpack:///./src/components/map/convert.ts","webpack:///./src/components/button/index.tsx","webpack:///./src/components/device-control/index.tsx","webpack:///./src/components/device-page/clusters.ts","webpack:///./src/components/safe-image/index.tsx","webpack:///./src/components/power-source/index.tsx","webpack:///./src/components/zigbee/ActionTH.tsx","webpack:///./src/components/zigbee/index.tsx","webpack:///./src/binaryUtils.ts","webpack:///./src/components/discovery/device-card.tsx","webpack:///./src/components/device-page/bind.tsx","webpack:///./src/components/device-page/bind-row.tsx","webpack:///./src/components/discovery/touchlink-device-card.tsx","webpack:///./src/components/discovery/index.tsx","webpack:///./src/components/log-viewer/index.tsx","webpack:///./src/components/tree-view/index.tsx","webpack:///./src/components/code-editor/codemirror.tsx","webpack:///./src/components/code-editor/index.tsx","webpack:///./src/components/universal-editor/index.tsx","webpack:///./src/components/device-page/simple-bind.tsx","webpack:///./src/components/device-page/info.tsx","webpack:///./src/components/tab-panel/index.tsx","webpack:///./src/components/device-page/index.tsx","webpack:///./src/store.ts","webpack:///./src/index.tsx","webpack:///./src/components/map/tooltip.css?6018","webpack:///./src/components/power-source/style.css?c52c","webpack:///./src/components/device-page/style.css?20cc","webpack:///./src/components/zigbee/style.css","webpack:///./src/components/discovery/style.css?5e9d","webpack:///external \"window.luaparse\"","webpack:///./src/components/code-editor/style.css?9305","webpack:///external \"window.CodeMirror\"","webpack:///./src/components/tree-view/style.css?8a62","webpack:///./src/components/log-viewer/style.css?542d"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","d3","ref","componentDidMount","current","this","link","props","render","id","rest","linkType","type","className","strokeWidth","xlinkHref","textPath","startOffset","linkQuality","filter","dy","links","x","y","width","height","in","map","index","genDeviceDetailsLink","deviceIdentifier","encodeURIComponent","toHex","input","padding","repeat","toString","substr","toUpperCase","genDeviceImageUrl","device","modelName","ModelId","replace","last","collection","bitOps","bitIndex","callApi","url","method","params","payload","callback","contentType","Promise","resolve","reject","fetch","keys","join","body","then","res","status","Error","statusText","catch","e","error","undefined","InterviewState","DeviceSupportStatus","PowerSource","lastSeen","timeInfo","last_seen","ts","secs","Math","floor","v","getStarShape","innerCircleArms","styleStarWidth","innerOuterRadiusRatio","centerX","centerY","innerRadius","outerRadius","angle","PI","totalArms","points","cos","sin","calcStarPoints","isOnline","state","imgUrl","onMouseOut","node","onMouseOver","onDblClick","onImageError","setState","time","deviceType","cn","class","onError","href","updateDrag","simulation","dragForce","on","active","alphaTarget","restart","fx","fy","componentDidUpdate","nodes","GATEWAY","nwkAddr","friendly_name","ManufName","info","tooltip","strings","ieeeAddr","st","linkquality","getTooltip","dev","loadBindsList","action","err","response","rule","idx","events","event","listener","removeListener","indexOf","emit","forEach","args","once","remove","remoteSubscribe","category","categories","includes","ws","send","JSON","stringify","onMessageReceive","wsEvent","parse","em","console","log","EventEmitter","connect","hostname","document","location","wsUrl","search","addEventListener","subscribe","eventCategory","consumer","store","setLoading","isLoading","getDeviceInfo","isError","setBindRules","bindRules","getDeviceBinds","getZigbeeDevicesList","showLoading","devices","removeBind","bindRule","createBind","setStateValue","setSimpleBindValue","setSimpleBind","startInterview","currentInterviewState","fetchTimeInfo","setJoinDuration","duration","target","enableJoin","fetchLogsBuffer","logs","split","getState","copyLogs","getCurrentLogLevel","logLevel","clearLogs","clearLogsBuffer","setLogLevel","level","setCurrentFileContent","currentFileContent","evalCode","code","executionResults","clearExecutionResults","writeFile","path","content","getFilesList","files","readFile","file","currentFile","deleteFile","renameDevice","old","newName","new","removeDevice","force","refreshState","touchlinkScan","touchlinkResuts","touchlinkScanInProgress","touchlinkList","currentChannel","touchlinkIdentify","touchlinkRest","getDistance","setTooltip","tooltipNode","removeTooltip","openDetailsWindow","open","graph","updateNodes","updateForces","linkLabel","attr","max","min","source","bbox","getBBox","linkForce","distance","strength","chargeForce","distanceMin","distanceMax","repelForce","collisionForce","iterations","centerForce","initPage","coordinator","getLinkType","dest","deviceData","friendlyName","Array","isArray","Rtg","route","destination","find","convert2graph","getBoundingClientRect","container","viewBox","foreignObject","onClick","item","children","onBindClick","onRenameClick","prompt","onRemoveClick","confirm","validDevice","role","ZigbeeClusters","isOk","description","PowerSourceComp","battery","batteryClass","hasSecondaryPowerSource","Battery","title","EmergencyMains","MainsThreePhase","EmergencyMainsConstantPower","MainsSinglePhase","plug","DC","Unknown","preventDefault","stopPropagation","column","renderArrow","currentDirection","invisible","saveState","storeData","sortDirection","sortColumn","localStorage","setItem","loadData","setInterval","onInterviewClick","Interview","State","success","onSortChange","sortDir","currentTime","Date","now","restoreState","storedState","getItem","restored","renderDevicesTable","renderInterviewState","interviewTrigger","getSupportTitle","supported","Supported","UnSupported","sortedDevices","adaptive","zigbee","titile","flags","src","EventLabels","Map","RowCol","EventRow","eventName","ParentnwkAddr","ep","ProfileId","DeviceId","evt","manualInterviewStarted","updateTimerId","currentTimestamp","isDone","getLastEvent","getLastUpdateTime","messageTimestamp","round","getLastUpdateTimeMessage","getInterviewText","lastEvent","renderManualInterviewHelper","lastUpdateTime","blink","componentWillReceiveProps","nextProps","nextContext","clearInterval","groupedEvents","eventsCount","progressValue","style","entries","getClusterName","addBraces","cleanName","onRuleChange","copyRules","onUnBindClick","renderBindsTable","scope","onChange","fields","isValidBindRule","some","getDeviceDisplayName","onDstChange","DstNwkAddr","DstEp","onClusterChange","parseInt","SrcEp","ClusterId","onDstEpChange","isExistingBinding","renderDstSelect","options","values","In","kvp","hasSelectedEpStr","label","selected","unshift","hidden","disabled","renderClusterId","optionGroups","epNumber","clusters","Out","renderDstEp","dstDevice","dstEndpoints","concat","has","endpoints","epName","renderActionButton","onIdentifyClick","onResetClick","LinkQuality","LogLevel","wsEventsData","processZigbeeEvent","message","timestamp","joinDuration","targetRouter","position","disableJoin","fetchTlResults","setTimeout","scanTL","manager","renderTLdevices","renderDevices","sortedEvents","reverse","renderJoinButton","routers","router","renderTlStartButton","renderEmptyScreen","hasAnyEvents","onFollowLogChange","followLog","onClearScreenClick","onClearCacheClick","onLogLevelChange","scrollToBottom","scrollTop","scrollHeight","LOG_OFF","LOG_NORMAL","LOG_VERBOSE","LOG_DEBUG","checked","for","line","lineNum","onDeleteClick","items","onItemClick","registerHelper","text","found","parseResult","from","Pos","to","codemirrorValueChanged","doc","change","origin","getValue","config","codeMirror","fromTextArea","setValue","setSize","currentCode","setOption","prevScrollPosition","getScrollInfo","prevCursor","getCursor","scrollTo","left","top","setCursor","onCodeChange","onExecuteCode","onSaveCode","onCreateFile","fileName","startsWith","loadFiles","loadFile","toggleSideBar","sideBarIsVisible","onFormatClick","getFileType","renderCodeExecutionResults","fileExtPattern","test","exec","getMode","json","theme","styleActiveLine","lineNumbers","lint","gutters","extraKeys","hasExecutionResults","hasCode","wrapper","toggled","placeholder","readOnly","changeHandler","valueAsNumber","step","onBlur","refresh","renderSimpleBinds","simpleBindRules","SB","kv","param","renderDeviceInfo","inClusters","clusterId","cluster","outClusters","profId","devId","isActive","onTabLinkClick","activeTab","initializeDefaultTab","defaultTab","tabs","TabComponent","searchParams","URL","paramActiveTab","deviceId","loader","initialState","forceRender","processZigbeData","applyStateChange","DevicePageApp","ZigbeeTableApp","MapApp","DiscoveryApp","LogViewerApp","CodeEditorApp","selector","clean","luaparse","CodeMirror"],"mappings":"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","file":"scripts/main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"2YZa\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"_3UsUxhqLZHNtuszm8EI_1s\",\"img\":\"fuuZbvihQGWIy3CO8t5fw\",\"node\":\"I_ddn1k4fvLAQLh2qam_d\",\"link\":\"oJeonYZxCbLDqS9yrBiG5\",\"linkLabel\":\"ipEfrGz4VI8P2v-Hm0MgN\",\"links\":\"qlfIBJJwZ24x2b-QgFmLW\",\"nodes\":\"_1eZESYvchmyr8mmKIBCmBR\",\"EndDevice\":\"_113dX3BKO5fr4pAzdXC69K\",\"Coordinator\":\"_3-cVoVzbbOOvbMydd2G1J6\",\"Router\":\"_1NuCcdsGVpzqyMOXPkAEco\",\"Router2Coordinator\":\"_16GkebpgcHFnf2uJIgqlWu\",\"Router2Router\":\"_2nbipMaMmif3N4YQw4wgIC\",\"EndDevice2Coordinator\":\"_2kxuG_VR9_Fy7SGa4OSXVQ\",\"EndDevice2Router\":\"_3fc-4gZS_GCPbobf1dvlBo\",\"foreignObject\":\"nnn_JJwC5kC3gKbpcaXVA\",\"offline\":\"_2eFLqqfzaRUzHTEot23elk\"};","module.exports = window.d3;","import { LinkI } from \"./types\";\nimport { Component, ComponentChild, createRef, FunctionalComponent, h, RefObject } from \"preact\";\nimport * as style from \"./map.css\";\nimport cx from \"classnames\";\nimport * as d3 from \"d3\";\n\ninterface LinkProps {\n    link: LinkI;\n    id?: string;\n}\n\nclass Link extends Component<LinkProps, {}> {\n    ref = createRef<SVGPathElement>();\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { link } = this.props;\n        d3.select(current as SVGPathElement).data([link]);\n    }\n\n    render(): ComponentChild {\n        const { link, id, ...rest } = this.props;\n        const linkType = link.type as string;\n        return (\n            <path\n                id={id}\n                {...rest}\n                className={cx(style.link, style[linkType])}\n                ref={this.ref as RefObject<SVGPathElement>}\n                strokeWidth={1}\n            />\n        );\n    }\n}\n\ninterface LinkLabelProps extends LinkProps {\n    xlinkHref: string;\n}\n\nclass LinkLabel extends Component<LinkLabelProps, {}> {\n    ref = createRef<SVGTextElement>();\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { link } = this.props;\n        d3.select(current as SVGTextElement).data([link]);\n    }\n\n    render(): ComponentChild {\n        const { link, xlinkHref } = this.props;\n        /* eslint-disable @typescript-eslint/ban-ts-ignore */\n        //@ts-ignore\n        const textPath = <textPath startOffset=\"50%\" xlinkHref={xlinkHref}>{link.linkQuality}</textPath>;\n        return (\n            <text\n                filter={\"url(#solid)\"}\n                className={style.linkLabel}\n                ref={this.ref}\n                dy={4}\n            >{textPath}\n            </text>\n        );\n    }\n}\n\ninterface LinksPros {\n    links: LinkI[];\n}\n\nconst Links: FunctionalComponent<LinksPros> = props => {\n    const { links } = props;\n    return (\n        <g className={style.links}>\n            <defs>\n                <filter x=\"-0.1\" y=\"0\" width=\"1.2\" height=\"1\" id=\"solid\">\n                    <feFlood flood-color=\"#eef5f9\" />\n                    <feComposite in=\"SourceGraphic\" />\n                </filter>\n            </defs>\n            {links.map((link: LinkI, index: number) => (\n                <Link\n                    id={`edgepath${index}`}\n                    key={`link${index}`}\n                    link={link}\n                />\n            ))}\n            {links.map((link: LinkI, index: number) => (\n                <LinkLabel\n                    xlinkHref={`#edgepath${index}`}\n                    key={`label${index}`}\n                    link={link}\n                />\n            ))}\n        </g>\n    );\n};\nexport default Links;\n","import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport { Device, Dictionary } from \"./types\";\nimport { TimeInfo } from \"./components/discovery/types\";\nimport { Notyf } from \"notyf\";\n\nexport const genDeviceDetailsLink = (deviceIdentifier: string | number): string => (`/zigbee/device?dev=${encodeURIComponent(deviceIdentifier)}&activeTab=Info`);\n\nexport const toHex = (input: number, padding = 4): string => {\n    return `0x${(`${'0'.repeat(padding)}${input.toString(16)}`).substr(-1 * padding).toUpperCase()}`;\n};\n\n/**\n * Returns an array with arrays of the given size.\n *\n * @param inputArr {Array} array to split\n * @param chunkSize {Integer} Size of every group\n */\nexport function chunkArray<T>(inputArr: T[], chunkSize: number): T[][] {\n\n    const results = [];\n    while (inputArr.length) {\n        results.push(inputArr.splice(0, chunkSize));\n    }\n    return results;\n}\n\nexport const encodeGetParams = (data: Dictionary<string | number>): string => Object.keys(data).map((key) => [key, data[key]].map(encodeURIComponent).join(\"=\")).join(\"&\");\n\nexport const WSConnect = (): ReconnectingWebSocket => {\n    const { hostname } = document.location;\n    if (hostname === \"localhost\") {\n        const { search } = document.location;\n        if (search.indexOf(\"gate\") > 0) {\n            return new ReconnectingWebSocket(`ws://192.168.1.209:81/log`);\n        }\n        return new ReconnectingWebSocket(`ws://localhost:8579`);\n    } else return new ReconnectingWebSocket(`ws://${document.location.hostname}:81/log`);\n};\n\nexport const sanitizeModelNameForImageUrl = (modelName: string): string => {\n    return modelName ? modelName.replace(\"/\", \"_\") : null;\n};\n\nexport const genDeviceImageUrl = (device: Device): string => (`https://raw.githubusercontent.com/slsys/Gateway/master/devices/png/${sanitizeModelNameForImageUrl(device.ModelId)}.png`);\n\nexport type LoadableFileTypes = \"js\" | \"css\";\n\nexport const fetchJs = (url) => {\n    return new Promise((resolve, reject) => {\n        const scriptElement = document.createElement(\"script\");\n        scriptElement.addEventListener(\"load\", resolve);\n        scriptElement.addEventListener(\"error\", reject);\n        scriptElement.setAttribute(\"type\", \"text/javascript\");\n        scriptElement.setAttribute(\"src\", url);\n        document.getElementsByTagName(\"head\")[0].appendChild(scriptElement);\n    });\n};\n\nexport const fetchStyle = (url) => {\n    return new Promise((resolve, reject) => {\n        const link = document.createElement(\"link\");\n        link.addEventListener(\"load\", resolve);\n        link.addEventListener(\"error\", reject);\n        link.setAttribute(\"type\", \"text/css\");\n        link.setAttribute(\"rel\", \"stylesheet\");\n        link.setAttribute(\"href\", url);\n        document.getElementsByTagName(\"head\")[0].appendChild(link)\n    });\n};\n\nexport function last<T>(collection: T[]) {\n    return collection[collection.length - 1];\n}\nexport function arrayUnique<T>(input: T[]) {\n    return input.filter((v, i, a) => a.indexOf(v) === i);\n}\n\n\n\nexport const bitOps = {\n    getBit: (n: number, bitIndex: number): number => {\n        const bitMask = 1 << bitIndex;\n        const result = n & bitMask;\n        return result >>> bitIndex;\n    },\n    setBit: (n: number, bitIndex: number): number => {\n        const bitMask = 1 << bitIndex;\n        return n | bitMask;\n    },\n    clearBit: (n: number, bitIndex: number): number => {\n        const bitMask = ~(1 << bitIndex);\n        return n & bitMask;\n    }\n};\n\n\nexport const toHHMMSS = (secs: number): string => {\n    const hours = Math.floor(secs / 3600);\n    const minutes = Math.floor(secs / 60) % 60;\n    const seconds = Math.floor(secs % 60);\n\n    return [hours, minutes, seconds]\n        .map(v => v < 10 ? `0${v}` : v)\n        .filter((v, i) => v !== \"00\" || i > 0)\n        .join(\":\");\n};\ntype HttMethod = \"GET\" | \"POST\" | \"DELETE\";\ntype ContentType = \"text\" | \"json\" | \"blob\";\nexport type CallbackHandler<T> = (err: boolean, res: T) => void;\nexport interface ApiResponse<T> {\n    success: boolean;\n    result: T;\n}\nexport function callApi<T>(url: string, method: HttMethod, params: Dictionary<any>, payload: any, callback: CallbackHandler<T>, contentType: ContentType = \"json\"): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n        fetch(`${url}?${encodeGetParams(params)}`, { method, body: payload })\n            .then((res) => {\n                if (res.status === 200) {\n                    return res[contentType]();\n                }\n                throw new Error(res.statusText);\n\n            })\n            .then(data => {\n                callback(false, data);\n                resolve();\n            })\n            .catch(e => {\n                new Notyf().error(e.toString());\n                callback(e.toString(), undefined);\n                reject();\n            });\n    })\n}\n\nexport const lastSeen = (device: Device, timeInfo: TimeInfo): string => {\n    if (device.last_seen && timeInfo) {\n        const lastSeen = timeInfo.ts - device.last_seen;\n        if (lastSeen < 0) {\n            return \"Now\";\n        }\n        return toHHMMSS(lastSeen);\n    }\n};","import { Named } from \"./components/tree-view\";\n\nexport type DeviceType = \"EndDevice\" | \"Router\" | \"Coordinator\";\n\nexport type Dictionary<V> = { [index: string]: V }\n\nexport interface DeviceStats {\n    linkquality?: number;\n    battery?: number;\n    [k: string]: string | number| boolean;\n}\n\nexport const inteviewsCount = 4;\n\nexport enum InterviewState {\n    StateUnknown = -1,\n    AnnouncementReceived = 0,\n    DescriptionRecieved = 1,\n    EndpointsRecieved = 2,\n    ClustersRecieved = 3,\n    ModelRecieved = 4\n}\n\n\ninterface Interview {\n    /** Last intreview timestamp */\n    TS?: number;\n    /**\n     * 0 - получен анонс, запускает интервью\n     * 1 - получено описание устройства\n     * 2 - получено количествы активные эндпоинты\n     * 3 - получены кластеры\n     * 4- получена модель\n     */\n    State?: InterviewState;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Cluster {\n\n}\n\nexport interface Endpoint {\n    \"profId\": string;\n    \"In\"?: Dictionary<true>;\n    \"Out\"?: Dictionary<true>;\n    \"devId\": string;\n}\n\nexport enum DeviceSupportStatus {\n    Unknown = 0,\n    Supported = 1,\n    UnSupported = 2\n}\n\n\nexport enum PowerSource {\n    Unknown = 0,\n    MainsSinglePhase = 1,\n    MainsThreePhase = 2,\n    Battery = 3,\n    DC = 4,\n    EmergencyMainsConstantPower = 5,\n    EmergencyMains = 6\n}\n\nexport interface Device {\n    change?: number;\n    /** A 64-bit IEEE address (also called MAC address or Extended address) */\n    ieeeAddr?: string | undefined;\n    /** A 16-bi network address */\n    nwkAddr: string;\n    /** Node last message timestamp */\n    last_seen?: number | undefined;\n    type?: DeviceType | undefined;\n\n    ManufName?: string | undefined;\n    ModelId?: string | undefined;\n    /** Device status */\n    st?: DeviceStats | undefined;\n    friendly_name?: string | undefined;\n    /** Routes list, each item is an 16-bit network address (also called logical address or short address). */\n    Rtg?: string[] | undefined;\n    /** Features discovery status, aka interview */\n    Interview?: Interview | undefined;\n    PowerSource?: PowerSource | undefined;\n    ep?: Dictionary<Endpoint> | undefined;\n    supported?: DeviceSupportStatus | undefined;\n    SB?: Dictionary<string> | undefined;\n\n\n    flags?: number | undefined;\n    Rcf?: unknown;\n}\n\n\nexport interface FileDescriptor extends Named {\n    name: string;\n    size: number;\n    is_dir: boolean;\n}\n\n\nexport interface BindRule extends Dictionary<string | number> {\n    id?: number;\n    DstNwkAddr: string;\n    ClusterId: number;\n    SrcEp: number;\n    DstEp: number;\n}\n\nexport type SortDirection = \"asc\" | \"desc\";\n\nexport interface TouchLinkDevice {\n    Channel: number;\n    LinkQuality: number;\n    PanId: number;\n    TS: number;\n    ieeeAddr: string;\n}\nexport interface TouchLinkScanApiResponse {\n    TS: number;\n    devices: TouchLinkDevice[];\n    currentChannel: number;\n}","import { Component, ComponentChild, createRef, h, RefObject } from \"preact\";\n\n\nimport * as d3 from \"d3\";\nimport { LinkI, NodeI } from \"./types\";\nimport cx from \"classnames\";\n\nimport * as style from \"./map.css\";\nimport { MouseEventsResponderNode } from \".\";\nimport { Device } from \"../../types\";\nimport { genDeviceImageUrl } from \"../../utils\";\nimport { TimeInfo } from \"../discovery/types\";\n\nconst calcStarPoints = (\n    centerX: number,\n    centerY: number,\n    innerCircleArms: number,\n    innerRadius: number,\n    outerRadius: number\n): string => {\n    const angle = Math.PI / innerCircleArms;\n    const angleOffsetToCenterStar = 60;\n    const totalArms = innerCircleArms * 2;\n    let points = \"\";\n    for (let i = 0; i < totalArms; i++) {\n        const isEvenIndex = i % 2 == 0;\n        const r = isEvenIndex ? outerRadius : innerRadius;\n        const currX = centerX + Math.cos(i * angle + angleOffsetToCenterStar) * r;\n        const currY = centerY + Math.sin(i * angle + angleOffsetToCenterStar) * r;\n        points += `${currX}, ${currY} `;\n    }\n    return points;\n};\n\n\nconst getStarShape = (innerCircleArms: number, styleStarWidth: number, innerOuterRadiusRatio: number): string => {\n    return calcStarPoints(\n        15,\n        15,\n        innerCircleArms,\n        styleStarWidth,\n        innerOuterRadiusRatio\n    );\n};\n\ninterface NodeProps extends MouseEventsResponderNode {\n    time: TimeInfo;\n    node: NodeI;\n}\n\nconst offlineTimeout = 3600 * 2;\n\nexport const isOnline = (device: Device, timeInfo: TimeInfo | undefined): boolean => {\n    if (!timeInfo || !device.last_seen) {\n        return true;\n    }\n    return timeInfo.ts - device.last_seen < offlineTimeout;\n};\n\ninterface NodeState {\n    imgUrl: string;\n}\n\nclass Node extends Component<NodeProps, NodeState> {\n    ref = createRef<SVGPolygonElement | SVGCircleElement | SVGImageElement>();\n    state = {\n        imgUrl: \"\"\n    };\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { node } = this.props;\n\n        d3.select(current as SVGElement).data([node]);\n\n        // eslint-disable-next-line react/no-did-mount-set-state\n        this.setState({\n            imgUrl: genDeviceImageUrl(node.device)\n        });\n    }\n\n\n    onMouseOut = (): void => {\n        const { node, onMouseOut } = this.props;\n        onMouseOut && onMouseOut(node);\n    };\n\n    onMouseOver = (): void => {\n        const { node, onMouseOver } = this.props;\n        onMouseOver && onMouseOver(node);\n    };\n\n    onDblClick = (): void => {\n        const { node, onDblClick } = this.props;\n        onDblClick && onDblClick(node);\n    };\n\n\n    onImageError = (): void => {\n        this.setState({\n            imgUrl: \"https://raw.githubusercontent.com/slsys/Gateway/master/devices/png/generic-zigbee-device.png\"\n        });\n    };\n\n    render(): ComponentChild {\n        const { imgUrl } = this.state;\n        const { node, time } = this.props;\n        const { onMouseOver, onMouseOut, onDblClick, onImageError } = this;\n        const deviceType = (node.device as Device).type as string;\n        const cn = cx(style.node, style[deviceType], { [style.offline]: !isOnline(node.device, time) });\n        return (<g class={cn}\n                   ref={this.ref as RefObject<SVGImageElement>}\n                   onMouseOver={onMouseOver}\n                   onMouseOut={onMouseOut}\n                   onDblClick={onDblClick}>\n            {\n                node.device.type === \"Coordinator\" ? (\n                    <polygon\n                        points={getStarShape(5, 5, 14) as string}\n                    />\n                ) : (\n                    <image\n                        width={32}\n                        height={32}\n                        onError={onImageError}\n\n                        className={`${style.img}`}\n\n                        href={imgUrl}\n                    />\n                )\n            }\n            <text>{node.name}</text>\n\n        </g>);\n\n    }\n}\n\ninterface NodesProps extends MouseEventsResponderNode {\n    time: TimeInfo;\n    nodes: NodeI[];\n    simulation: d3.Simulation<NodeI, LinkI>;\n}\n\ninterface NodesState {\n    tooltipNode: NodeI | undefined;\n}\n\nexport default class Nodes extends Component<NodesProps, NodesState> {\n    updateDrag(): void {\n        const { simulation } = this.props;\n        const dragForce = d3.drag<SVGCircleElement, NodeI>()\n            .on(\"start\", d => {\n                if (!d3.event.active) {\n                    simulation.alphaTarget(0.3).restart();\n                }\n                d.fx = d.x;\n                d.fy = d.y;\n            })\n            .on(\"drag\", d => {\n                d.fx = d3.event.x;\n                d.fy = d3.event.y;\n            })\n            .on(\"end\", d => {\n                if (!d3.event.active) {\n                    simulation.alphaTarget(0);\n                }\n                d.fx = undefined;\n                d.fy = undefined;\n            });\n\n\n        d3.selectAll<SVGCircleElement, NodeI>(`.${style.node}`)\n            .call(dragForce);\n    }\n\n    componentDidMount(): void {\n        this.updateDrag();\n    }\n\n    componentDidUpdate(): void {\n        this.updateDrag();\n    }\n\n    render(): ComponentChild {\n        const { nodes, onMouseOut, onMouseOver, onDblClick, time } = this.props;\n        return (\n            <g className={style.nodes}>\n                {nodes.map((node: NodeI, index: number) => (\n                    <Node\n                        time={time}\n                        onMouseOut={onMouseOut}\n                        onMouseOver={onMouseOver}\n                        onDblClick={onDblClick}\n                        key={index}\n                        node={node}\n                    />\n                ))}\n            </g>\n        );\n    }\n}\n","import { Device } from \"../../types\";\n\n\nexport const GATEWAY: Device = {\n    nwkAddr: \"coordinator\",\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    friendly_name: \"Coordinator node\",\n    // eslint-disable-next-line @typescript-eslint/camelcase\n    type: \"Coordinator\",\n    ManufName: \"SLS gateway\"\n};\n","import { NodeI } from \"./types\";\nimport style from \"./tooltip.css\";\nimport { FunctionalComponent, h } from \"preact\";\nimport { isOnline } from \"./nodes\";\nimport { Device } from \"../../types\";\nimport { lastSeen } from \"../../utils\";\nimport { TimeInfo } from \"../discovery/types\";\n\ninterface TooltipProps {\n    info: NodeI;\n    time: TimeInfo;\n}\n\nconst getTooltip = (device: Device, timeInfo: TimeInfo): string[] => {\n    const strings: string[] = [];\n    if (device.ManufName) {\n        if (device.ModelId) {\n            strings.push(`${device.ManufName} ${device.ModelId}`);\n        } else {\n            strings.push(device.ManufName);\n        }\n    }\n    if (device.ieeeAddr) {\n        strings.push(device.ieeeAddr);\n    }\n    if (device?.st?.linkquality) {\n        strings.push(`LinkQuality: ${device.st.linkquality}`);\n    }\n    if (strings.length == 0) {\n        strings.push(\"A very strange device...\");\n    }\n    if (device.type !== \"Coordinator\") {\n        if (device.last_seen && timeInfo) {\n            strings.push(`Last seen: ${lastSeen(device, timeInfo)}`);\n        }\n        if (!isOnline(device, timeInfo)) {\n            strings.push(\"Offline\");\n        }\n    }\n    return strings;\n};\n\nconst Tooltip: FunctionalComponent<TooltipProps> = (props: TooltipProps) => {\n    const { info, time } = props;\n    const { device } = info;\n    return (\n        <div className={style.tooltip}>\n            {getTooltip(device, time).map((s) => <div>{s}</div>)}\n        </div>\n\n    );\n};\nexport default Tooltip;","import { BindRule, Device } from \"./types\";\nimport { ApiResponse, callApi, CallbackHandler } from \"./utils\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport { TimeInfo } from \"./components/discovery/types\";\n\nexport const fetchZigbeeDevicesList = (callback: CallbackHandler<Device[]>): Promise<void> => {\n    return callApi(\"/api/zigbee/devices\", \"GET\", {}, undefined, callback);\n};\nexport const fetchTimeInfo = (callback: CallbackHandler<TimeInfo>): Promise<void> => {\n    return callApi(\"/api/time\", \"GET\", {}, undefined, callback);\n};\nexport const startInterview = (dev: string, state: number | \"\", callback: CallbackHandler<void>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setInterview\", state }, undefined, callback);\n};\n\nexport const enableJoin = (duration = 255, target = \"\", callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee/join\", \"GET\", { duration, target }, undefined, callback);\n};\nexport const clearLogsBuffer = (callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"POST\", { action: \"clear\" }, undefined, callback);\n};\n\nexport const fetchLogsBuffer = (callback: CallbackHandler<string>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"GET\", { action: \"getBuffer\" }, undefined, callback, \"text\");\n};\n\nexport const setLogLevel = (logLevel: LogLevel, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"POST\", { action: \"setLevel\", value: logLevel }, undefined, callback);\n};\n\nexport const getCurrentLogLevel = (callback: CallbackHandler<ApiResponse<LogLevel>>): Promise<void> => {\n    return callApi(\"/api/messages-history\", \"GET\", { action: \"getLevel\" }, undefined, callback);\n};\n\nexport const writeFile = (path: string, content: string, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/files\", \"POST\", { path }, content, callback);\n};\nexport const evalCode = (code: string, callback: CallbackHandler<ApiResponse<string>>): Promise<void> => {\n    return callApi(\"/api/scripts\", \"POST\", { action: \"evalCode\" }, code, callback);\n};\n\nexport const getDeviceInfo = (dev: string, callback: CallbackHandler<Device>): Promise<void> => {\n    return callApi(\"/api/zigbee/devices\", \"GET\", { dev }, undefined, callback);\n};\nexport const setState = (dev: string, name: string, value: unknown, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setState\", name, value }, undefined, callback);\n};\nexport const setSimpleBind = (dev: string, name: string, value: unknown, callback: CallbackHandler<ApiResponse<void>>): Promise<void> => {\n    return callApi(\"/api/zigbee\", \"POST\", { dev, action: \"setSimpleBind\", name, value }, undefined, callback);\n};\nexport const loadBindsList = (dev: string, callback: CallbackHandler<BindRule[]>): Promise<void> => {\n    return callApi(\"/api/zigbee/bind\", \"GET\", { action: \"list\", dev }, undefined, (err, response: BindRule[]) => {\n        if (err) {\n            callback(true, []);\n        } else {\n            callback(err, response.map((rule, idx) => ({ ...rule, id: idx })));\n        }\n    });\n};\n\n\n\n\n","import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport { WebsocketMessage } from \"./components/discovery/types\";\nimport { Notyf } from \"notyf\";\nimport {PubSub} from \"pubsub-ts\";\nimport { Dictionary } from \"./types\";\ntype ZigbeeCallback = (payload: WebsocketMessage) => void;\n\nclass EventEmitter {\n    events: Dictionary<Function[]>;\n    constructor() {\n        this.events = {};\n    }\n    on(event: string, listener: Function): Function {\n        if (typeof this.events[event] !== 'object') {\n            this.events[event] = [];\n        }\n        this.events[event].push(listener);\n        return () => this.removeListener(event, listener);\n    }\n    removeListener(event: string, listener: Function): void {\n        if (typeof this.events[event] === 'object') {\n            const idx = this.events[event].indexOf(listener);\n            if (idx > -1) {\n                this.events[event].splice(idx, 1);\n            }\n        }\n    }\n    emit(event: string, ...args) {\n        if (typeof this.events[event] === 'object') {\n            this.events[event].forEach(listener => listener.apply(this, args));\n        }\n    }\n    once(event: string, listener: Function) {\n        const remove = this.on(event, (...args) => {\n            remove();\n            listener.apply(this, args);\n        });\n    }\n}\n\nexport default class WebsocketManager {\n    ws: ReconnectingWebSocket;\n    publisher: PubSub.Publisher;\n    em: EventEmitter;\n    categories: string[];\n\n    remoteSubscribe = (category: string): void => {\n        if (!this.categories.includes(category)) {\n            this.categories.push(category);\n        }\n        this.ws.send(JSON.stringify({ action: \"subscribe\", category }))\n    }\n\n    private connect(): void {\n        const { hostname } = document.location;\n        let wsUrl = `ws://${document.location.hostname}:81/log`;\n        if (hostname === \"localhost\") {\n            const { search } = document.location;\n            if (hostname === \"localhost\") {\n                if (search.indexOf(\"gate\") > 0) {\n                    wsUrl = `ws://192.168.1.209:81/log`;\n                } else {\n                    wsUrl = `ws://localhost:8579`;\n                }\n            }\n        }\n        this.ws = new ReconnectingWebSocket(wsUrl);\n        this.ws.addEventListener(\"open\", () => {\n            this.categories.forEach(this.remoteSubscribe);\n        })\n        this.ws.addEventListener(\"message\", this.onMessageReceive);\n    }\n\n    constructor() {\n        this.categories = [];\n        this.em = new EventEmitter();\n        // this.publisher = new PubSub.Publisher();\n        this.connect();\n    }\n    onMessageReceive = (wsEvent: MessageEvent): void => {\n        try {\n            const event = JSON.parse(wsEvent.data) as WebsocketMessage;\n            this.em.emit(event.category, event);\n            // this.publisher.notify(event.category, event);\n        } catch (e) {\n            new Notyf().error(`Cant parse json, ${e}`);\n            console.log(`Cant parse json, ${e}`, wsEvent.data);\n        }\n    };\n\n    subscribe(eventCategory: string, consumer: ZigbeeCallback): Function {\n        this.remoteSubscribe(eventCategory);\n        return this.em.on(eventCategory, consumer)\n    }\n}","/* eslint-disable @typescript-eslint/no-unused-vars */\n\n\nimport { GlobalState } from \"./store\";\nimport { Store } from \"unistore\";\nimport {\n    fetchZigbeeDevicesList,\n    getDeviceInfo,\n    loadBindsList,\n    setState,\n    setSimpleBind,\n    startInterview,\n    fetchTimeInfo,\n    enableJoin,\n    fetchLogsBuffer,\n    getCurrentLogLevel,\n    clearLogsBuffer,\n    setLogLevel,\n    evalCode,\n    writeFile,\n} from \"./legacy-actions\";\nimport { BindRule, FileDescriptor, TouchLinkScanApiResponse } from \"./types\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport WebsocketManager from \"./websocket\";\nimport orderBy from \"lodash/orderBy\";\nimport { ApiResponse, callApi } from \"./utils\";\n\nexport interface Actions {\n    setLoading(isLoading: boolean): Promise<void>;\n\n    getDeviceInfo(dev: string): Promise<void>;\n\n    getDeviceBinds(dev: string): Promise<void>;\n\n    getZigbeeDevicesList(showLoading: boolean): Promise<void>;\n\n    removeBind(dev: string, bindRule: BindRule): Promise<void>;\n\n    createBind(dev: string, bindRule: BindRule): Promise<void>;\n\n    setBindRules(bindRules: BindRule[]): Promise<void>;\n\n\n    setStateValue(dev: string, name: string, value: unknown): Promise<void>;\n    setSimpleBindValue(dev: string, name: string, value: unknown): Promise<void>;\n\n    startInterview(dev: string, state: number | \"\"): Promise<void>;\n\n    fetchTimeInfo(): Promise<void>;\n\n    setJoinDuration(duration: number, target: string): Promise<void>;\n    fetchLogsBuffer(): Promise<void>;\n    getCurrentLogLevel(): Promise<void>;\n    clearLogs(): Promise<void>;\n    clearLogsBuffer(): Promise<void>;\n    setLogLevel(level: LogLevel): Promise<void>;\n\n    setCurrentFileContent(content: string): Promise<void>;\n\n    evalCode(code: string): Promise<void>;\n    writeFile(fileName: string, content: string): Promise<void>;\n\n    clearExecutionResults(): Promise<void>;\n\n    getFilesList(path: string): Promise<void>;\n\n    readFile(file: FileDescriptor): Promise<void>;\n    deleteFile(file: FileDescriptor): Promise<void>;\n\n    renameDevice(old: string, newName: string): Promise<void>;\n    removeDevice(dev: string, force: boolean): Promise<void>;\n    refreshState(dev: string, name: string): Promise<void>;\n\n    touchlinkScan(): Promise<void>;\n    touchlinkList(): Promise<void>;\n    touchlinkIdentify(dev: string): Promise<void>;\n    touchlinkRest(dev: string): Promise<void>;\n}\n\nconst actions = (store: Store<GlobalState>): object => ({\n    setLoading(state, isLoading: boolean): void {\n        store.setState({ isLoading });\n    },\n    getDeviceInfo: async (state, dev: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        await getDeviceInfo(dev, (err, device) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                device\n            });\n        });\n    },\n\n    setBindRules(state, bindRules: BindRule[]): void {\n        store.setState({ bindRules });\n    },\n    getDeviceBinds: async (state, dev: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        await loadBindsList(dev, (err, bindRules: []) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                bindRules: [{} as BindRule, ...bindRules]\n            });\n        })\n    },\n    getZigbeeDevicesList: (state, showLoading = true): Promise<void> => {\n        showLoading && store.setState({ isLoading: true });\n        return fetchZigbeeDevicesList((err, devices) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                devices\n            });\n        });\n    },\n\n    removeBind: (state, dev: string, bindRule: BindRule): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi(\"/api/zigbee/bind\", \"POST\", { action: \"unbind\", dev, ...bindRule }, undefined, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        })\n    },\n    createBind: (state, dev: string, bindRule: BindRule): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi(\"/api/zigbee/bind\", \"POST\", { action: \"bind\", dev, ...bindRule }, undefined, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n\n\n    setStateValue(state, dev: string, name: string, value: unknown): Promise<void> {\n        store.setState({ isLoading: true });\n        return setState(dev, name, value, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    setSimpleBindValue(state, dev: string, name: string, value: unknown): Promise<void> {\n        store.setState({ isLoading: true });\n        return setSimpleBind(dev, name, value, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    startInterview(state, dev: string, currentInterviewState: number | \"\"): Promise<void> {\n        store.setState({ isLoading: true });\n        return startInterview(dev, currentInterviewState, (err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false\n            });\n        });\n    },\n    fetchTimeInfo(state): Promise<void> {\n        return fetchTimeInfo((err, time) => {\n            store.setState({ time });\n        });\n    },\n\n    setJoinDuration(state, duration = 255, target = \"\"): Promise<void> {\n        store.setState({ isLoading: true });\n        return enableJoin(duration, target, (err, time) => {\n            store.setState({ isLoading: false });\n        });\n    },\n    async fetchLogsBuffer(state): Promise<void> {\n        store.setState({ isLoading: true });\n        await fetchLogsBuffer((err, logs) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                logs: logs.split(\"\\n\")\n            });\n        })\n\n        const wsManager = new WebsocketManager();\n        wsManager.subscribe(\"log\", (data) => {\n            const { logs } = store.getState();\n            const copyLogs = [...logs, data.payload as string];\n            store.setState({ logs: copyLogs });\n        });\n    },\n    getCurrentLogLevel(state): Promise<void> {\n        store.setState({ isLoading: true });\n        return getCurrentLogLevel((err, response) => {\n            store.setState({\n                isError: err,\n                isLoading: false,\n                logLevel: response.result\n            });\n        });\n    },\n    clearLogs(state): void {\n        store.setState({ logs: [] });\n    },\n    clearLogsBuffer(state): Promise<void> {\n        store.setState({ isLoading: true });\n        return clearLogsBuffer((err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    setLogLevel(state, level: LogLevel): Promise<void> {\n        store.setState({ isLoading: true });\n        return setLogLevel(level, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    setCurrentFileContent(state, currentFileContent: string): void {\n        store.setState({ currentFileContent });\n    },\n    evalCode(state, code): Promise<void> {\n        store.setState({ isLoading: true });\n        return evalCode(code, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                executionResults: res\n            });\n        });\n    },\n    clearExecutionResults(state): void {\n        store.setState({ executionResults: null });\n    },\n    writeFile(state, path, content): Promise<void> {\n        store.setState({ isLoading: true });\n        return writeFile(path, content, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    async getFilesList(state, path: string): Promise<void> {\n        store.setState({ isLoading: true });\n        await callApi<ApiResponse<FileDescriptor[]>>(\"/api/files\", \"GET\", { path }, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                files: orderBy(res.result, [\"name\"])\n            });\n        })\n    },\n\n    async readFile(state, file: FileDescriptor): Promise<void> {\n        store.setState({ isLoading: true });\n        await callApi<string>(\"/api/files\", \"GET\", { path: file.name }, undefined, (err, response) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                currentFileContent: response,\n                currentFile: file\n            });\n        }, \"text\");\n    },\n\n    deleteFile(state, file: FileDescriptor): Promise<void> {\n        store.setState({ isLoading: true });\n        return callApi<void>(\"/api/files\", \"DELETE\", { path: file.name }, undefined, (err, response) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    renameDevice: (state, old: string, newName: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        return callApi<ApiResponse<void>>(\"/api/zigbee/rename\", \"GET\", { old, new: newName }, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    removeDevice: (state, dev: string, force: boolean): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = { dev };\n        if (force) {\n            params['force'] = 1;\n        }\n        return callApi<ApiResponse<void>>(\"/api/zigbee/remove\", \"DELETE\", params, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n\n\n    refreshState: (state, dev: string, name: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = {\n            dev, name,\n            action: 'getState'\n        }\n        return callApi<ApiResponse<void>>(\"/api/zigbee\", \"GET\", params, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n\n    touchlinkScan: (state): Promise<void> => {\n        store.setState({ isLoading: true, touchlinkResuts: null });\n        const params = {\n            action: 'scan'\n        };\n        return callApi<ApiResponse<void>>(\"/api/zigbee/touchlink\", \"GET\", params, undefined, (err, res) => {\n            store.setState({\n                touchlinkScanInProgress: true,\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n\n    touchlinkList: (state): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = {\n            action: 'list'\n        };\n        return callApi<ApiResponse<TouchLinkScanApiResponse>>(\"/api/zigbee/touchlink\", \"GET\", params, undefined, (err, { result }) => {\n            store.setState({\n                isLoading: false,\n                isError: err,\n                touchlinkScanInProgress: result.currentChannel !== 0,\n                touchlinkResuts: result\n            });\n        });\n    },\n\n    touchlinkIdentify: (state, dev: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = {\n            action: 'identify',\n            dev\n        };\n        return callApi<ApiResponse<TouchLinkScanApiResponse>>(\"/api/zigbee/touchlink\", \"GET\", params, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    },\n    touchlinkRest: (state, dev: string): Promise<void> => {\n        store.setState({ isLoading: true });\n        const params = {\n            action: 'reset',\n            dev\n        };\n        return callApi<ApiResponse<TouchLinkScanApiResponse>>(\"/api/zigbee/touchlink\", \"GET\", params, undefined, (err, res) => {\n            store.setState({\n                isLoading: false,\n                isError: err\n            });\n        });\n    }\n});\nexport default actions;\n","import { Component, ComponentChild, createRef, h } from \"preact\";\nimport Links from \"./links\";\nimport Nodes from \"./nodes\";\nimport * as d3 from \"d3\";\nimport style from \"./map.css\";\nimport { GraphI, LinkI, NodeI } from \"./types\";\nimport { convert2graph } from \"./convert\";\nimport Tooltip from \"./tooltip\";\nimport { genDeviceDetailsLink } from \"../../utils\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\n\nexport interface MouseEventsResponderNode {\n    onMouseOver?: (arg0: NodeI) => void;\n    onMouseOut?: (arg0: NodeI) => void;\n    onDblClick?: (arg0: NodeI) => void;\n}\n\ninterface MapState {\n    graph: GraphI;\n    tooltipNode: NodeI | false;\n    width: number;\n    height: number;\n}\n\nconst getDistance = (d: LinkI): number => {\n    switch (d.type) {\n        case \"Router2Router\":\n        case \"Router2Coordinator\":\n            return 300;\n        case \"EndDevice2Coordinator\":\n        case \"EndDevice2Router\":\n            return 150;\n        default:\n            return 200;\n    }\n};\n\nexport class Map extends Component<GlobalState & Actions, MapState> {\n    ref = createRef<HTMLDivElement>();\n    simulation!: d3.Simulation<NodeI, LinkI>;\n\n    constructor() {\n        super();\n\n\n        this.simulation = d3.forceSimulation<NodeI>();\n\n        this.state = {\n            width: 0,\n            height: 0,\n            graph: {\n                nodes: [],\n                links: []\n            },\n            tooltipNode: false\n        };\n    }\n\n    updateNodes(): void {\n        this.updateForces();\n        const node = d3.selectAll<SVGGeometryElement, NodeI>(\n            `.${style.node}`\n        );\n        const link = d3.selectAll<SVGLineElement, LinkI>(\n            `.${style.link}`\n        );\n        const linkLabel = d3.selectAll<SVGLineElement, LinkI>(\n            `.${style.linkLabel}`\n        );\n        const ticked = (): void => {\n            const radius = 40;\n            const { width, height } = this.state;\n\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            link.attr(\"d\", (d: LinkI): string => `M ${Math.max(radius, Math.min(width - radius, d.source.x))} ${Math.max(radius, Math.min(height - radius, d.source.y))} L ${Math.max(radius, Math.min(width - radius, d.target.x))} ${Math.max(radius, Math.min(height - radius, d.target.y))}`);\n\n            linkLabel.attr(\"transform\", function(d) {\n                //TODO: add type guard\n                if (((d.target as NodeI).x as number) < ((d.source as NodeI).x as number)) {\n                    const bbox = this.getBBox();\n                    const rx = bbox.x + bbox.width / 2;\n                    const ry = bbox.y + bbox.height / 2;\n                    return `rotate(180 ${rx} ${ry})`;\n                }\n                return \"rotate(0)\";\n            });\n            const imgXShift = 32 / 2;\n            const imgYShift = 32 / 2;\n            node.attr(\"transform\", d => `translate(${Math.max(radius, Math.min(width - radius, d.x)) - imgXShift}, ${Math.max(radius, Math.min(height - radius, d.y)) - imgYShift})`);\n        };\n        const { graph } = this.state;\n        this.simulation.nodes(graph.nodes).on(\"tick\", ticked);\n        const linkForce = this.simulation.force(\"link\") as d3.ForceLink<NodeI,\n            LinkI>;\n        linkForce.links(graph.links);\n        this.simulation.restart();\n    }\n\n    setTooltip = (tooltipNode: NodeI): void => {\n        this.setState({ tooltipNode });\n    };\n\n    removeTooltip = (): void => {\n        this.setState({ tooltipNode: false });\n    };\n\n    openDetailsWindow = (node: NodeI): void => {\n        switch (node.device.type) {\n            case \"EndDevice\":\n            case \"Router\":\n                window.open(genDeviceDetailsLink(node.id));\n                break;\n            default:\n                break;\n        }\n    };\n\n    updateForces(): void {\n        const { width, height } = this.state;\n\n        const linkForce = d3.forceLink<NodeI, LinkI>()\n            .id(d => d.id)\n            .distance(getDistance)\n            .strength(0.2);\n\n        const chargeForce = d3.forceManyBody()\n            .distanceMin(200)\n            .distanceMax(1000)\n            .strength(-200);\n\n        const repelForce = d3.forceManyBody()\n            .strength(-140)\n            .distanceMax(50)\n            .distanceMin(10);\n\n        const collisionForce = d3.forceCollide(40)\n            .strength(1)\n            .iterations(100);\n\n        const centerForce = d3.forceCenter(width / 2, height / 2);\n\n        this.simulation\n            .force(\"link\", linkForce)\n            .force(\"charge\", chargeForce)\n            .force(\"collisionForce\", collisionForce)\n            .force(\"repelForce\", repelForce)\n            .force(\"center\", centerForce);\n    }\n\n    async initPage(): Promise<void> {\n        const { getZigbeeDevicesList } = this.props;\n        await getZigbeeDevicesList(true);\n        const { devices } = this.props;\n        const graph = convert2graph(devices);\n        const { width, height } = (this.ref.current as HTMLDivElement).getBoundingClientRect();\n        this.setState({ graph, width, height }, this.updateNodes);\n    }\n\n    async componentDidMount(): Promise<void> {\n        await this.initPage()\n    }\n\n    render(): ComponentChild {\n        const { width, height, graph, tooltipNode } = this.state;\n        const { time } = this.props;\n        const { setTooltip, removeTooltip, openDetailsWindow } = this;\n        return (\n            <div className={style.container} ref={this.ref}>\n                <svg viewBox={`0 0 ${width} ${height}`}>\n                    <Links links={graph.links} />\n                    <Nodes\n                        nodes={graph.nodes}\n                        simulation={this.simulation}\n                        onMouseOver={setTooltip}\n                        onMouseOut={removeTooltip}\n                        onDblClick={openDetailsWindow}\n                        time={time}\n                    />\n                    {tooltipNode ? (\n                        <foreignObject\n                            className={style.foreignObject}\n                            x={tooltipNode.x as number + 10}\n                            y={tooltipNode.y as number + 5}\n                        >\n                            <Tooltip info={tooltipNode} time={time} />\n                        </foreignObject>\n                    ) : null}\n                </svg>\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [\"time\", \"devices\"];\nconst ConnectedMap = connect<{}, MapState, GlobalState, Actions>(mappedProps, actions)(Map);\nexport default ConnectedMap;\n","import { GATEWAY } from \"./consts\";\nimport { GraphI, LinkType, NodeI } from \"./types\";\nimport { Device, DeviceType } from \"../../types\";\n\nconst getName = (device: Device): string => {\n    const { friendly_name: friendlyName, nwkAddr } = device;\n    if (friendlyName && friendlyName !== \"null\") {\n        return friendlyName;\n    }\n    return nwkAddr;\n};\nexport const convert2graph = (devices: Device[]): GraphI => {\n    const coordinator: NodeI = {\n        id: GATEWAY.nwkAddr,\n        device: GATEWAY,\n        name: \"GW\"\n    };\n\n    const graph: GraphI = {\n        nodes: [coordinator],\n        links: []\n    };\n    const getLinkType = (source: DeviceType, dest: DeviceType): LinkType => `${source}2${dest}` as LinkType;\n\n    devices.forEach((deviceData) => {\n        graph.nodes.push({\n            id: deviceData.nwkAddr,\n            name: getName(deviceData),\n            device: deviceData\n        });\n        if (Array.isArray(deviceData.Rtg) && deviceData.Rtg.length) {\n            deviceData.Rtg.forEach(route => {\n                const destination = devices.find(d => d.nwkAddr == route.toString()) || GATEWAY;\n                graph.links.push({\n                    source: deviceData.nwkAddr,\n                    target: destination.nwkAddr,\n                    linkQuality: deviceData?.st?.linkquality,\n                    type: getLinkType(deviceData.type, destination.type)\n                });\n            });\n        } else {\n            graph.links.push({\n                source: deviceData.nwkAddr,\n                target: coordinator.id,\n                linkQuality: deviceData?.st?.linkquality,\n                type: getLinkType(deviceData.type, \"Coordinator\")\n            });\n        }\n    });\n    return graph;\n};\n","import { Component, ComponentChild, h } from \"preact\";\n\ninterface ButtonProps<T> {\n    item?: T;\n    className?: string;\n\n    onClick?(arg1: T): void;\n}\n\nexport default class Button<T> extends Component<ButtonProps<T>, {}> {\n    onClick = (): void => {\n        const { item, onClick } = this.props;\n        onClick && onClick(item);\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        return <button {...rest} onClick={this.onClick}>{children}</button>;\n    }\n}\n\n\nexport class Link<T> extends Component<ButtonProps<T>, {}> {\n    onClick = (): void => {\n        const { item, onClick } = this.props;\n        onClick && onClick(item);\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        return <a href=\"#\" {...rest} onClick={this.onClick}>{children}</a>;\n    }\n}","import { Component, ComponentChild, h, Fragment } from \"preact\";\nimport Button from \"../button\";\nimport { Device } from \"../../types\";\nimport { connect } from \"unistore/preact\";\nimport actions, { Actions } from \"../../actions\";\nimport cx from \"classnames\";\ninterface DeviceControlGroupProps {\n    device: Device;\n}\n\nexport class DeviceControlGroup extends Component<DeviceControlGroupProps & Actions, {}> {\n    onBindClick = (): void => {\n        const { device } = this.props;\n        location.href = `/zigbee/device?dev=${encodeURIComponent(device.nwkAddr)}&activeTab=Bind`;\n    };\n\n    onRenameClick = async (): Promise<void> => {\n        const { renameDevice, getZigbeeDevicesList, getDeviceInfo, device } = this.props;\n        const newName = prompt(\"Enter new name\", device.friendly_name);\n        if (newName !== null && newName !== device.friendly_name) {\n            await renameDevice(device.nwkAddr, newName);\n            await getZigbeeDevicesList(true);\n            await getDeviceInfo(device.nwkAddr);\n        }\n    };\n\n\n    onRemoveClick = async (force = false): Promise<void> => {\n        const { removeDevice, getZigbeeDevicesList, device } = this.props;\n        const message = force ? \"Remove device?\" : \"Send leave request?\";\n        if (confirm(message)) {\n            await removeDevice(device.nwkAddr, force);\n            await getZigbeeDevicesList(true);\n        }\n    };\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        const validDevice = !!device.ieeeAddr;\n\n        return (\n            <div className=\"btn-group btn-group-sm\" role=\"group\">\n                <Button<void> className=\"btn btn-secondary\" onClick={this.onRenameClick}><i\n                    className=\"fa fa-edit\" /></Button>\n                <Button<void> className=\"btn btn-success\" onClick={this.onBindClick}>Bind</Button>\n                {\n                    <Fragment>\n                        <button type=\"button\" class=\"btn btn-danger dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"><i className={cx(\"fa\", \"fa-trash\")} /></button>\n                        <div class=\"dropdown-menu\" aria-labelledby=\"btnGroupDrop1\">\n                            {validDevice ? <a class=\"dropdown-item\" href=\"#\" onClick={(): Promise<void> => this.onRemoveClick(false)}>Send leave req</a> : null}\n                            <a class=\"dropdown-item\" href=\"#\" onClick={(): Promise<void> => this.onRemoveClick(true)}>Remove</a>\n                        </div>\n                    </Fragment>\n                }\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [];\nconst ConnectedDeviceControlGroup = connect<DeviceControlGroupProps, {}, {}, Actions>(mappedProps, actions)(DeviceControlGroup);\nexport default ConnectedDeviceControlGroup;\n\n","export enum ZigbeeClusters {\n    // General Clusters\n    ZCL_CLUSTER_ID_GEN_BASIC=                             0x0000,\n    ZCL_CLUSTER_ID_GEN_POWER_CFG=                         0x0001,\n    ZCL_CLUSTER_ID_GEN_DEVICE_TEMP_CONFIG=                0x0002,\n    ZCL_CLUSTER_ID_GEN_IDENTIFY=                          0x0003,\n    ZCL_CLUSTER_ID_GEN_GROUPS=                            0x0004,\n    ZCL_CLUSTER_ID_GEN_SCENES=                            0x0005,\n    ZCL_CLUSTER_ID_GEN_ON_OFF=                            0x0006,\n    ZCL_CLUSTER_ID_GEN_ON_OFF_SWITCH_CONFIG=              0x0007,\n    ZCL_CLUSTER_ID_GEN_LEVEL_CONTROL=                     0x0008,\n    ZCL_CLUSTER_ID_GEN_ALARMS=                            0x0009,\n    ZCL_CLUSTER_ID_GEN_TIME=                              0x000A,\n    ZCL_CLUSTER_ID_GEN_LOCATION=                          0x000B,\n    ZCL_CLUSTER_ID_GEN_ANALOG_INPUT_BASIC=                0x000C,\n    ZCL_CLUSTER_ID_GEN_ANALOG_OUTPUT_BASIC=               0x000D,\n    ZCL_CLUSTER_ID_GEN_ANALOG_VALUE_BASIC=                0x000E,\n    ZCL_CLUSTER_ID_GEN_BINARY_INPUT_BASIC=                0x000F,\n    ZCL_CLUSTER_ID_GEN_BINARY_OUTPUT_BASIC=               0x0010,\n    ZCL_CLUSTER_ID_GEN_BINARY_VALUE_BASIC=                0x0011,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_INPUT_BASIC=            0x0012,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_OUTPUT_BASIC=           0x0013,\n    ZCL_CLUSTER_ID_GEN_MULTISTATE_VALUE_BASIC=            0x0014,\n    ZCL_CLUSTER_ID_GEN_COMMISSIONING=                     0x0015,\n    ZCL_CLUSTER_ID_GEN_PARTITION=                         0x0016,\n\n    ZCL_CLUSTER_ID_OTA=                                   0x0019,\n\n    ZCL_CLUSTER_ID_GEN_POWER_PROFILE=                     0x001A,\n    ZCL_CLUSTER_ID_GEN_APPLIANCE_CONTROL=                 0x001B,\n\n    ZCL_CLUSTER_ID_GEN_POLL_CONTROL=                      0x0020,\n\n    ZCL_CLUSTER_ID_GREEN_POWER_PROXY=                     0x0021,\n\n// Closures Clusters,\n    ZCL_CLUSTER_ID_CLOSURES_SHADE_CONFIG=                 0x0100,\n    ZCL_CLUSTER_ID_CLOSURES_DOOR_LOCK=                    0x0101,\n    ZCL_CLUSTER_ID_CLOSURES_WINDOW_COVERING=              0x0102,\n\n// HVAC Clusters,\n    ZCL_CLUSTER_ID_HVAC_PUMP_CONFIG_CONTROL=              0x0200,\n    ZCL_CLUSTER_ID_HVAC_THERMOSTAT=                       0x0201,\n    ZCL_CLUSTER_ID_HVAC_FAN_CONTROL=                      0x0202,\n    ZCL_CLUSTER_ID_HVAC_DIHUMIDIFICATION_CONTROL=         0x0203,\n    ZCL_CLUSTER_ID_HVAC_USER_INTERFACE_CONFIG=            0x0204,\n\n// Lighting Clusters,\n    ZCL_CLUSTER_ID_LIGHTING_COLOR_CONTROL=                0x0300,\n    ZCL_CLUSTER_ID_LIGHTING_BALLAST_CONFIG=               0x0301,\n\n// Measurement and Sensing Clusters,\n    ZCL_CLUSTER_ID_MS_ILLUMINANCE_MEASUREMENT=            0x0400,\n    ZCL_CLUSTER_ID_MS_ILLUMINANCE_LEVEL_SENSING_CONFIG=   0x0401,\n    ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT=            0x0402,\n    ZCL_CLUSTER_ID_MS_PRESSURE_MEASUREMENT=               0x0403,\n    ZCL_CLUSTER_ID_MS_FLOW_MEASUREMENT=                   0x0404,\n    ZCL_CLUSTER_ID_MS_RELATIVE_HUMIDITY=                  0x0405,\n    ZCL_CLUSTER_ID_MS_OCCUPANCY_SENSING=                  0x0406,\n\n// Security and Safety (SS) Clusters,\n    ZCL_CLUSTER_ID_SS_IAS_ZONE=                           0x0500,\n    ZCL_CLUSTER_ID_SS_IAS_ACE=                            0x0501,\n    ZCL_CLUSTER_ID_SS_IAS_WD=                             0x0502,\n// Protocol Interfaces,\n    ZCL_CLUSTER_ID_PI_GENERIC_TUNNEL=                     0x0600,\n    ZCL_CLUSTER_ID_PI_BACNET_PROTOCOL_TUNNEL=             0x0601,\n    ZCL_CLUSTER_ID_PI_ANALOG_INPUT_BACNET_REG=            0x0602,\n    ZCL_CLUSTER_ID_PI_ANALOG_INPUT_BACNET_EXT=            0x0603,\n    ZCL_CLUSTER_ID_PI_ANALOG_OUTPUT_BACNET_REG=           0x0604,\n    ZCL_CLUSTER_ID_PI_ANALOG_OUTPUT_BACNET_EXT=           0x0605,\n    ZCL_CLUSTER_ID_PI_ANALOG_VALUE_BACNET_REG=            0x0606,\n    ZCL_CLUSTER_ID_PI_ANALOG_VALUE_BACNET_EXT=            0x0607,\n    ZCL_CLUSTER_ID_PI_BINARY_INPUT_BACNET_REG=            0x0608,\n    ZCL_CLUSTER_ID_PI_BINARY_INPUT_BACNET_EXT=            0x0609,\n    ZCL_CLUSTER_ID_PI_BINARY_OUTPUT_BACNET_REG=           0x060A,\n    ZCL_CLUSTER_ID_PI_BINARY_OUTPUT_BACNET_EXT=           0x060B,\n    ZCL_CLUSTER_ID_PI_BINARY_VALUE_BACNET_REG=            0x060C,\n    ZCL_CLUSTER_ID_PI_BINARY_VALUE_BACNET_EXT=            0x060D,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_INPUT_BACNET_REG=        0x060E,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_INPUT_BACNET_EXT=        0x060F,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_OUTPUT_BACNET_REG=       0x0610,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_OUTPUT_BACNET_EXT=       0x0611,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_VALUE_BACNET_REG=        0x0612,\n    ZCL_CLUSTER_ID_PI_MULTISTATE_VALUE_BACNET_EXT=        0x0613,\n    ZCL_CLUSTER_ID_PI_11073_PROTOCOL_TUNNEL =      0x0614,\n\n// Advanced Metering Initiative (SE) Clusters,\n    ZCL_CLUSTER_ID_SE_PRICING=                            0x0700,\n    ZCL_CLUSTER_ID_SE_LOAD_CONTROL=                       0x0701,\n    ZCL_CLUSTER_ID_SE_SIMPLE_METERING=                    0x0702,\n    ZCL_CLUSTER_ID_SE_MESSAGE=                            0x0703,\n    ZCL_CLUSTER_ID_SE_SE_TUNNELING=                       0x0704,\n    ZCL_CLUSTER_ID_SE_PREPAYMENT=                         0x0705,\n    ZCL_CLUSTER_ID_SE_ENERGY_MGMT=                        0x0706,\n    ZCL_CLUSTER_ID_SE_TOU_CALENDAR=                       0x0707,\n    ZCL_CLUSTER_ID_SE_DEVICE_MGMT=                        0x0708,\n    ZCL_CLUSTER_ID_SE_EVENTS=                             0x0709,\n    ZCL_CLUSTER_ID_SE_MDU_PAIRING=                        0x070A,\n\n    ZCL_CLUSTER_ID_GEN_KEY_ESTABLISHMENT=                 0x0800,\n\n    ZCL_CLUSTER_ID_HA_APPLIANCE_IDENTIFICATION=           0x0B00,\n    ZCL_CLUSTER_ID_HA_METER_IDENTIFICATION=               0x0B01,\n    ZCL_CLUSTER_ID_HA_APPLIANCE_EVENTS_ALERTS=            0x0B02,\n    ZCL_CLUSTER_ID_HA_APPLIANCE_STATISTICS=               0x0B03,\n    ZCL_CLUSTER_ID_HA_ELECTRICAL_MEASUREMENT=             0x0B04,\n    ZCL_CLUSTER_ID_HA_DIAGNOSTIC=                         0x0B05,\n\n    // Light Link cluster\n    ZCL_CLUSTER_ID_TOUCHLINK=                           0x1000\n}\n","import { Component, ComponentChild, h } from \"preact\";\n\ninterface SafeImgState {\n    isOk: boolean;\n}\n\ninterface SafeImgProps {\n    [k: string]: any;\n}\n\nexport default class SafeImg extends Component<SafeImgProps, SafeImgState> {\n    constructor() {\n        super();\n        this.state = {\n            isOk: true\n        };\n    }\n\n    onError = (): void => {\n        this.setState({\n            isOk: false\n        });\n\n    };\n\n    render(): ComponentChild {\n        const { children, ...rest } = this.props;\n        const { isOk } = this.state;\n        return isOk ? <img {...rest} onError={this.onError} /> : children;\n    }\n}","import { Fragment, FunctionalComponent, h } from \"preact\";\nimport { PowerSource } from \"../../types\";\nimport style from \"./style.css\";\nimport { bitOps } from \"../../utils\";\n\ninterface PowerSourceProps {\n    source: PowerSource;\n    battery?: number;\n    className?: string;\n}\nconst description = [\n    \"Unknown\",\n    \"Mains (single phase)\",\n    \"Mains (3 phase)\",\n    \"Battery\",\n    \"DC source\",\n    \"Emergency mains constantly powered\",\n    \"Emergency mains and transfer switch\"\n];\n\nconst PowerSourceComp: FunctionalComponent<PowerSourceProps> = ({ source, battery,className }) => {\n    let batteryClass = \"fa-battery-full\";\n    //Bit b7 of this attribute SHALL be set to 1 if the device has a secondary power source in the form of a battery\n    // backup. Otherwise, bit b7 SHALL be set to 0.\n    const hasSecondaryPowerSource = bitOps.getBit(source, 7) == 1;\n    if (hasSecondaryPowerSource) {\n        source = bitOps.clearBit(source, 7);\n    }\n\n    switch (source) {\n        case PowerSource.Battery:\n            if (battery) {\n                if (battery > 75) {\n                    batteryClass = \"fa-battery-full\";\n                } else if (battery >= 75) {\n                    batteryClass = \"fa-battery-three-quarters\";\n                } else if (battery >= 50) {\n                    batteryClass = \"fa-battery-half\";\n                } else if (battery >= 25) {\n                    batteryClass = \"fa-battery-quarter\";\n                } else {\n                    batteryClass =\"fa-battery-empty\"\n                }\n            }\n            return <i className={`fa ${batteryClass} ${className}`}\n                      title={`${description[source]} ${battery ? `, power level ${battery}%` : \"\"} `} />;\n\n        case PowerSource.EmergencyMains:\n        case PowerSource.MainsThreePhase:\n        case PowerSource.EmergencyMainsConstantPower:\n        case PowerSource.MainsSinglePhase:\n            return (<Fragment>\n                <i className={`fa fa-plug ${style.plug} ${className}`} title={description[source]} />\n                {hasSecondaryPowerSource ? <PowerSourceComp className={'d-block'} source={PowerSource.Battery} battery={battery} /> : null }\n            </Fragment>);\n        case PowerSource.DC:\n            return (<Fragment>\n                <i class={`fa fa-charging-station ${className}`} title={description[source]} />\n                {hasSecondaryPowerSource ? <PowerSourceComp className={'d-block'} source={PowerSource.Battery} battery={battery} /> : null }\n            </Fragment>);\n\n        case PowerSource.Unknown:\n        default:\n            return <i className={`fa fa-question ${className}`} title={description[0]} />;\n    }\n};\n\nexport default PowerSourceComp;\n","import { Component, ComponentChild, h } from \"preact\";\nimport style from \"./style.css\";\nimport { SortDirection } from \"../../types\";\n\n\n\ninterface ActionTHProps<T> {\n    column: T;\n    current: T;\n    currentDirection: SortDirection;\n\n    onClick?(arg1: unknown): void;\n\n    [k: string]: unknown;\n}\n\nexport default class ActionTH<T> extends Component<ActionTHProps<T>, {}> {\n    onClick = (event: MouseEvent): void => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { column, onClick } = this.props;\n        onClick && onClick(column);\n    };\n\n    renderArrow(): ComponentChild {\n        const { currentDirection, current, column } = this.props;\n        if (current === column) {\n            if (currentDirection == \"asc\") {\n                return <i className={`fa fa-sort-amount-down-alt`} />;\n            } else  {\n                return <i className={`fa fa-sort-amount-down`} />;\n            }\n\n        }\n        return <i className={`fa fa-sort-amount-down ${style.invisible}`} />;\n\n    }\n\n    render(): ComponentChild {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { children, onClick, current, column, ...rest } = this.props;\n        return <th {...rest}>\n            <a href=\"#\" onClick={this.onClick}>{children}</a>\n            {this.renderArrow()}\n        </th>;\n    }\n}","import style from \"./style.css\";\nimport { Component, ComponentChild, h } from \"preact\";\nimport Button from \"../button\";\nimport orderBy from \"lodash/orderBy\";\nimport DeviceControlGroup from \"../device-control\";\nimport cx from \"classnames\";\nimport { Device, DeviceSupportStatus, inteviewsCount, SortDirection } from \"../../types\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, lastSeen } from \"../../utils\";\nimport SafeImg from \"../safe-image\";\nimport { Notyf } from \"notyf\";\nimport PowerSource from \"../power-source\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport ActionTH from \"./ActionTH\";\nimport { isLeaveReqSend } from \"../../binaryUtils\";\n\n//TODO: proper type alias\ntype SortColumns =\n    \"last_seen\"\n    | \"nwkAddr\"\n    | \"friendly_name\"\n    | \"ieeeAddr\"\n    | \"ManufName\"\n    | \"st.linkquality\"\n    | \"ModelId\"\n    | \"Interview.State\"\n    | \"PowerSource\";\n\n\ninterface ZigbeeTableState {\n    sortDirection: SortDirection;\n    sortColumn: SortColumns;\n    currentTime: number;\n}\n\n\n\n\nconst storeKey = \"ZigbeeTableState\";\n\nexport class ZigbeeTable extends Component<Actions & GlobalState, ZigbeeTableState> {\n    constructor() {\n        super();\n        this.state = {\n            sortDirection: \"desc\",\n            sortColumn: \"last_seen\",\n            currentTime: Date.now()\n        };\n    }\n\n    restoreState(): void {\n        const storedState = localStorage.getItem(storeKey);\n        if (storedState) {\n            try {\n                const restored: Partial<ZigbeeTableState> = JSON.parse(storedState);\n                this.setState(restored);\n            } catch (e) {\n                new Notyf().error(e.toString());\n            }\n        }\n    }\n\n    saveState = (): void => {\n        const { sortDirection, sortColumn } = this.state;\n        const storeData = {\n            sortDirection,\n            sortColumn\n        };\n        //in private mode localstorage access can throw exceptions\n        try {\n            localStorage.setItem(storeKey, JSON.stringify(storeData));\n        } catch (e) {\n            new Notyf().error(e.toString());\n        }\n    };\n\n    loadData = (showLoading = true): void => {\n        const {getZigbeeDevicesList, fetchTimeInfo} = this.props;\n        getZigbeeDevicesList(showLoading);\n        fetchTimeInfo();\n        setInterval(fetchTimeInfo, 5000);\n    };\n\n\n    componentDidMount(): void {\n        this.restoreState();\n        this.loadData();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    onInterviewClick = async (device: Device): Promise<void> => {\n        const { startInterview } = this.props;\n        if (confirm(\"Start Interview?\")) {\n            await startInterview(device.nwkAddr, device?.Interview?.State)\n            new Notyf().success(\"Started interview\");\n        }\n    };\n\n    onSortChange = (column: SortColumns, sortDir: SortDirection | undefined = undefined): void => {\n        const { sortColumn } = this.state;\n        let { sortDirection } = this.state;\n\n        if (sortColumn === column) {\n            if (sortDir) {\n                sortDirection = sortDir;\n            } else if (sortDirection == \"asc\") {\n                sortDirection = \"desc\";\n            } else {\n                sortDirection = \"asc\";\n            }\n        }\n\n        this.setState({ sortColumn: column, sortDirection }, this.saveState);\n    };\n\n    render(): ComponentChild {\n        const { devices, isLoading } = this.props;\n        if (isLoading) {\n            return <div className=\"d-flex justify-content-center\">\n                <div className=\"spinner-border\" role=\"status\">\n                    <span className=\"sr-only\">Loading...</span>\n                </div>\n            </div>;\n        }\n        return (devices.length ? this.renderDevicesTable() : <div>No data</div>);\n    }\n\n    renderInterviewState(device: Device): ComponentChild {\n        const { onInterviewClick } = this;\n        const interviewTrigger = <Button<Device> className=\"btn btn-normal btn-sm\" onClick={onInterviewClick}\n                                                 item={device}><i className=\"fa fa-play\" /></Button>;\n\n        if (device.Interview) {\n            if (inteviewsCount === device.Interview.State) {\n                return \"Ok\";\n            }\n            return <div>{device.Interview.State ?? 0}/{inteviewsCount} {interviewTrigger}</div>;\n        }\n        return <div>N/A {interviewTrigger}</div>;\n    }\n\n    getSupportTitle(device: Device): string {\n        switch (device.supported) {\n            case DeviceSupportStatus.Supported:\n                return \"Supported\";\n            case DeviceSupportStatus.Unknown:\n                return \"Support unknown\";\n            case DeviceSupportStatus.UnSupported:\n                return \"Unsupported\";\n            default:\n                return \"\";\n        }\n    }\n\n    renderDevicesTable(): ComponentChild {\n        const { sortColumn, sortDirection } = this.state;\n        const { time, devices } = this.props;\n        const sortedDevices = orderBy<Device>(devices, [sortColumn], [sortDirection]);\n        const { onSortChange } = this;\n\n        return (\n            <table className={`table table-striped table-borderless ${style.adaptive} ${style.zigbee}`}>\n                <thead>\n                <tr className=\"text-nowrap\">\n                    <th>#</th>\n                    <th>Pic</th>\n                    <ActionTH<SortColumns> className={cx(style[\"nwk-addr\"], style[\"action-column\"])} column=\"nwkAddr\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>nwkAddr</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"friendly_name\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>FriendlyName</ActionTH>\n                    <ActionTH<SortColumns> className={cx(style[\"ieee-addr\"], style[\"action-column\"])} column=\"ieeeAddr\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>ieeeAddr</ActionTH>\n                    <ActionTH<SortColumns> className={cx(style[\"manu-name\"], style[\"action-column\"])} column=\"ManufName\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange} titile=\"ManufName\">Manuf</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"ModelId\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>ModelId</ActionTH>\n\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"st.linkquality\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange} title=\"Link quality\">Link</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"Interview.State\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>Interview</ActionTH>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"last_seen\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>LastSeen</ActionTH>\n                    <th>Routes</th>\n                    <ActionTH<SortColumns> className={style[\"action-column\"]} column=\"PowerSource\"\n                                           currentDirection={sortDirection} current={sortColumn}\n                                           onClick={onSortChange}>PS</ActionTH>\n                    <th>Actions</th>\n                </tr>\n                </thead>\n                <tbody>\n                {sortedDevices.map((device: Device, index) => <tr className={cx({\n                    \"table-danger\": !device.ieeeAddr,\n                    \"table-warning\": isLeaveReqSend(device.flags)\n                })}>\n                    <td className=\"font-weight-bold\">{index + 1}</td>\n                    <td className={style[\"device-pic\"]}><SafeImg class={cx(style[\"device-image\"])}\n                                                                 src={genDeviceImageUrl(device)} />\n                    </td>\n                    <td className={style[\"nwk-addr\"]}><a\n                        href={genDeviceDetailsLink(device.nwkAddr)}>{device.nwkAddr}</a>\n                    </td>\n                    <td>{device.friendly_name}</td>\n                    <td className={style[\"ieee-addr\"]}>{device.ieeeAddr ? device.ieeeAddr : \"<corrupted>\"}</td>\n                    <td title={device.ManufName}\n                        className={cx(style[\"manu-name\"], \"text-truncate\", \"text-nowrap\", \"position-relative\")}>{device.ManufName}</td>\n                    <td title={this.getSupportTitle(device)} className={cx(\"text-nowrap\", {\n                        \"table-danger\": device.supported == DeviceSupportStatus.UnSupported,\n                        \"table-warning\": device.supported == DeviceSupportStatus.Unknown\n                    })}>{device.ModelId}</td>\n                    <td>{device.st?.linkquality}</td>\n                    <td className={cx({\n                        \"table-warning\": device.Interview?.State !== 4\n                    })}>{this.renderInterviewState(device)}</td>\n                    <td>{lastSeen(device, time)}</td>\n                    <td>{device?.Rtg?.map((route) => <a className={\"d-block\"}\n                        href={genDeviceDetailsLink(route)}>{route}</a>)}</td>\n                    <td className=\"text-left\"><PowerSource source={device.PowerSource} battery={device.st?.battery} /></td>\n                    <td>\n                        <DeviceControlGroup device={device} />\n                    </td>\n                </tr>)}\n\n                </tbody>\n            </table>\n\n        );\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"time\", \"devices\", \"forceRender\"];\nconst ConnectedDevicePage = connect<{}, ZigbeeTableState, GlobalState, Actions>(mappedProps, actions)(ZigbeeTable);\nexport default ConnectedDevicePage;\n","export const isLeaveReqSend = (flags: number): boolean => {\n    return !!(flags & 0x01);\n}","import { Component, ComponentChild, Fragment, FunctionalComponent, h, VNode } from \"preact\";\n\nimport style from \"./style.css\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, last } from \"../../utils\";\nimport cx from \"classnames\";\nimport { ZigbeeEvent, ZigbeePayload } from \"./types\";\nimport groupBy from \"lodash/groupBy\";\nimport { Device, Dictionary } from \"../../types\";\nimport DeviceControlGroup from \"../device-control\";\nimport Button from \"../button\";\nimport SafeImg from \"../safe-image\";\nimport PowerSourceComp from \"../power-source\";\nimport uniqWith from \"lodash/uniqWith\";\nimport isEqual from \"lodash/isEqual\";\n\nconst INTERVIEW_STEPS_COUNT = 9;\nconst DEVICE_NOT_RESPONDING_TIMEOUT = 5;\nconst DEVICE_MANUAL_WAKEUP_TIMEOUT = 5;\n\ninterface DeviceCardProps {\n    ieeeAddr: string;\n    events: ZigbeePayload[];\n\n    startInterview(nwkAddr: string, state: number): void;\n}\n\nconst EventLabels = new Map<ZigbeeEvent, string>([\n    [\"LeaveInd\", \"Left network\"],\n    [\"TcDeviceInd\", \"Device joined\"],\n    [\"DeviceAnnceInd\", \"Announce received\"],\n    [\"SimpleDescRsp\", \"Clusters received\"],\n    [\"ActiveEpRsp\", \"Endpoints received\"],\n    [\"ModelRcv\", \"Model received\"],\n    [\"NodeDescRsp\", \"Processing interviews\"],\n    [\"PowerSrcRcv\", \"Power source received\"],\n    [\"ConfRsp\", \"Finished interview\"]\n]);\n\nconst RowCol: FunctionalComponent<{ title: string; content: ComponentChild }> = ({ title, content }) => {\n    return (\n        <div class={`row ${style[\"scale-in-center\"]}`}>\n            <div class=\"col-5 text-nowrap\">{title}</div>\n            <div class=\"col\">{content}</div>\n        </div>\n    );\n};\n\ninterface EventRowProps {\n    eventName: ZigbeeEvent;\n    events: ZigbeePayload[];\n}\n\nconst EventRow: FunctionalComponent<EventRowProps> = ({ eventName, events }): VNode<any> => {\n    switch (eventName) {\n        case \"LeaveInd\":\n            return (\n                <RowCol title=\"Old nwkAddr:\" content={<del>{last(events).nwkAddr}</del>} />\n            );\n\n\n        case \"TcDeviceInd\":\n            return (\n                <Fragment>\n                    <RowCol title=\"New nwkAddr:\" content={last(events).nwkAddr} />\n                    {\n                        last(events).ParentnwkAddr ? (\n                            <RowCol title=\"ParentnwkAddr:\" content={last(events).ParentnwkAddr} />\n                        ) : null\n                    }\n                </Fragment>\n            );\n\n\n        case \"DeviceAnnceInd\":\n            return <RowCol title=\"Type:\" content={last(events).type} />;\n\n\n        case \"PowerSrcRcv\":\n            return <RowCol title=\"Power source:\" content={<PowerSourceComp source={last(events).PowerSource} />} />;\n\n        case \"SimpleDescRsp\":\n            return <Fragment>\n                {uniqWith(events\n                        .filter(e => e.ep)\n                        .map(({ ep, ProfileId, DeviceId }) => ({ ep, ProfileId, DeviceId }))\n                    , isEqual)\n                    .map(evt => (\n                        <RowCol title={`Endpoint #${evt.ep}:`}\n                                content={`ProfileId=${evt.ProfileId} DeviceId=${evt.DeviceId}`} />\n                    ))}\n            </Fragment>;\n\n\n        case \"ModelRcv\":\n            return (\n                <Fragment>\n                    <RowCol title=\"ManufName:\" content={last(events).ManufName || <small>detecting...</small>} />\n                    <RowCol title=\"Model:\" content={\n                        <Fragment>\n                            <div>{last(events).ModelId}</div>\n                            <SafeImg class={cx(style[\"device-image\"])}\n                                     src={genDeviceImageUrl({ ModelId: last(events).ModelId } as Device)\n                                     } />\n                        </Fragment>\n                    } />\n                </Fragment>\n            );\n\n        default:\n            return undefined;\n\n    }\n};\n\ninterface DeviceCardState {\n    currentTimestamp: number;\n    updateTimerId: number;\n    manualInterviewStarted: boolean;\n    isDone: boolean;\n}\n\nexport default class DeviceCard extends Component<DeviceCardProps, DeviceCardState> {\n    constructor() {\n        super();\n        const updateTimerId = window.setInterval(() => {\n            this.setState({ currentTimestamp: Date.now() });\n        }, 1000);\n\n\n        this.state = {\n            isDone: false,\n            manualInterviewStarted: false,\n            updateTimerId,\n            currentTimestamp: Date.now()\n        };\n    }\n\n    getLastEvent(): ZigbeePayload {\n        const { events } = this.props;\n        return events[events.length - 1];\n    }\n\n    getLastUpdateTime(): number {\n        const { timestamp: messageTimestamp } = this.getLastEvent();\n        const { currentTimestamp } = this.state;\n        return Math.max(0, Math.round((currentTimestamp - messageTimestamp) / 1000));\n    }\n\n    getLastUpdateTimeMessage(): string {\n        const lastMessage = this.getLastUpdateTime();\n        return `${lastMessage} sec ago`;\n    }\n\n    getInterviewText(): string {\n        const lastEvent = this.getLastEvent();\n        return EventLabels.get(lastEvent.event);\n    }\n\n    onInterviewClick = (nwkAddr: string): void => {\n        const { startInterview } = this.props;\n        startInterview(nwkAddr, 0);\n        this.setState({manualInterviewStarted: true});\n    };\n\n    renderManualInterviewHelper(): ComponentChild {\n        const { manualInterviewStarted } = this.state;\n        const { ieeeAddr } = this.props;\n\n        const lastUpdateTime = this.getLastUpdateTime();\n        if (manualInterviewStarted && lastUpdateTime > DEVICE_MANUAL_WAKEUP_TIMEOUT) {\n            return (<div class={`row ${style[\"scale-in-center\"]}`}>\n                <div class={`col-12 ${style.blink}`}>Press wakeup button</div>\n            </div>);\n        }\n        if (!manualInterviewStarted && lastUpdateTime > DEVICE_NOT_RESPONDING_TIMEOUT)\n            return (\n                <div class={`row ${style[\"scale-in-center\"]}`}>\n                    <div class=\"col-5\">Start interview:</div>\n                    <div class=\"col\">\n                        <Button<string> className=\"btn btn-normal btn-sm\" onClick={this.onInterviewClick}\n                                        item={ieeeAddr}><i className=\"fa fa-play\" /></Button>\n                    </div>\n                </div>\n            );\n    }\n\n    // eslint-disable-next-line react/no-deprecated\n    componentWillReceiveProps(nextProps: Readonly<DeviceCardProps>, nextContext: any): void {\n        const { events } = nextProps;\n        const lastEvent = events[events.length - 1];\n        const { updateTimerId } = this.state;\n        if (lastEvent && lastEvent.event === \"PowerSrcRcv\") {\n            // progressValue = 100;\n            window.clearInterval(updateTimerId);\n            this.setState({ isDone: true });\n        }\n    }\n\n    render(): ComponentChild {\n\n        const { isDone } = this.state;\n        const { events, ieeeAddr } = this.props;\n        const groupedEvents = groupBy(events, \"event\") as Dictionary<ZigbeePayload[]>;\n        const eventsCount = Object.keys(groupedEvents).length;\n        const progressValue = Math.round(100 / INTERVIEW_STEPS_COUNT * eventsCount);\n\n        return (\n            <div className={cx(\"card\", \"col-sm-4\", style[\"discovery-card\"], style[\"scale-in-center\"])}>\n                <div class=\"card-header\">\n                    Device <a href={genDeviceDetailsLink(ieeeAddr)}>{ieeeAddr}</a>\n                    <p class=\"card-text\"><small class=\"text-muted\">\n                        {isDone ? \"Successfully joined!\" : `Last updated ${this.getLastUpdateTimeMessage()}`}</small>\n                    </p>\n                </div>\n                <div className=\"card-body\">\n                    {!isDone ? (<p className=\"card-text\">\n                        <div className=\"progress\">\n                            <div className=\"progress-bar progress-bar-striped progress-bar-animated\"\n                                 style={`width: ${progressValue}%;`} aria-valuenow={progressValue} aria-valuemin=\"0\"\n                                 aria-valuemax=\"100\">{progressValue}%\n                            </div>\n                        </div>\n                    </p>) : null}\n\n\n                    <div class={`row ${style[\"scale-in-center\"]}`}>\n                        <div class=\"col-5\">Current status:</div>\n                        <div class=\"col\">{this.getInterviewText()}</div>\n                    </div>\n\n                    {\n                        Object.entries(groupedEvents).map(([eventName, events]) => ((\n                            <EventRow key={eventName} eventName={eventName as ZigbeeEvent} events={events} />)))\n                    }\n                    {\n                        isDone ? null : this.renderManualInterviewHelper()\n                    }\n                </div>\n                {isDone ? <div className=\"card-footer\">\n                    <DeviceControlGroup device={{ nwkAddr: ieeeAddr, ieeeAddr } as Device} />\n                </div> : null}\n            </div>\n        );\n    }\n}","import { Component, ComponentChild, h } from \"preact\";\nimport { BindRule, Device } from \"../../types\";\nimport { ZigbeeClusters } from \"./clusters\";\nimport BindRow from \"./bind-row\";\nimport actions, { Actions } from \"../../actions\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport { Notyf } from \"notyf\";\n\n\nexport const getClusterName = (id: number, addBraces = true): string => {\n    if (ZigbeeClusters[id]) {\n        const cleanName = (ZigbeeClusters[id] as string).replace(/^ZCL_CLUSTER_ID_/, \"\");\n        return addBraces ? ` (${cleanName})` : cleanName;\n    }\n    return \"\";\n};\n\ninterface PropsFromStore {\n    device: Device;\n    devices: Device[];\n    bindRules: BindRule[];\n}\n\nexport class Bind extends Component<PropsFromStore & Actions, {}> {\n    onRuleChange = (idx: number, rule: BindRule): void => {\n        const { bindRules, setBindRules } = this.props;\n        const copyRules = [...bindRules];\n        copyRules[idx] = rule;\n        setBindRules(copyRules);\n    };\n\n    onBindClick = async (rule: BindRule): Promise<void> => {\n        const { device, createBind, getDeviceBinds } = this.props;\n        await createBind(device.nwkAddr, rule)\n\n        await getDeviceBinds(device.nwkAddr);\n        new Notyf().success(`Created bind rule`);\n\n    };\n\n    onUnBindClick = async (rule: BindRule): Promise<void> => {\n        const { device, removeBind, getDeviceBinds } = this.props;\n        await removeBind(device.nwkAddr, rule);\n        await getDeviceBinds(device.nwkAddr);\n        new Notyf().success(`Removed bind rule`);\n\n    };\n\n    renderBindsTable(): ComponentChild {\n        const { bindRules, devices, device } = this.props;\n        return (\n            <table class=\"table table-striped table-borderless\">\n                <thead>\n                    <tr>\n                        <th scope=\"col\">#</th>\n                        <th scope=\"col\">Source Cluster/Ep</th>\n                        <th scope=\"col\">DstNwkAddr</th>\n                        <th scope=\"col\">DstEp</th>\n                        <th scope=\"col\">Action</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {\n                        bindRules.map((rule, idx) => <BindRow\n                            key={idx}\n                            onUnBindClick={this.onUnBindClick}\n                            onBindClick={this.onBindClick}\n                            onChange={this.onRuleChange}\n                            device={device}\n                            idx={idx}\n                            rule={rule}\n                            devices={devices} />)\n                    }\n                </tbody>\n            </table>\n        );\n    }\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderBindsTable();\n        }\n        return \"Loading...\";\n\n    }\n}\n\nconst mappedProps = [\"device\", \"devices\", \"bindRules\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps, actions)(Bind);","import { Component, ComponentChild, h } from \"preact\";\nimport flatten from \"lodash/flatten\";\nimport groupBy from \"lodash/groupBy\";\nimport sortBy from \"lodash/sortBy\";\nimport cx from \"classnames\";\nimport { toHex } from \"../../utils\";\nimport { getClusterName } from \"./bind\";\nimport { BindRule, Device } from \"../../types\";\n\nconst fields = [\"DstNwkAddr\", \"ClusterId\", \"SrcEp\", \"DstEp\"];\n\nfunction isValidBindRule(rule: BindRule): rule is BindRule {\n    return fields.some(key => rule[key] !== undefined);\n}\nexport const getDeviceDisplayName = (device: Device): string => {\n    return `${device.nwkAddr} (${device.friendly_name ? device.friendly_name : device.ModelId})`;\n};\ninterface BindRowProps {\n    onChange?(idx: number, rule: BindRule): void;\n\n    onBindClick?(rule: BindRule): void;\n\n    onUnBindClick?(rule: BindRule): void;\n\n    idx: number;\n    rule: BindRule;\n    devices: Device[];\n    device: Device;\n}\n\nexport default class BindRow extends Component<BindRowProps, {}> {\n\n\n    isExistingBinding(): boolean {\n        const { rule } = this.props;\n        return rule.id !== undefined;\n    }\n\n    onDstChange = (evt) => {\n        const { idx, rule, onChange } = this.props;\n        const { value } = evt.target;\n        onChange && onChange(idx, { ...rule, DstNwkAddr: value, DstEp: undefined });\n    };\n\n    renderDstSelect(): ComponentChild {\n        const { devices, rule, device } = this.props;\n        //exclude self from select\n        const options = sortBy(Object.entries(groupBy(devices.filter(d => d.nwkAddr !== device.nwkAddr), d => {\n            const inC = flatten(Object.values(d.ep ?? {}).map(ep => Object.keys(ep.In ?? {}).map(c => parseInt(c, 10))));\n            return inC.includes(rule.ClusterId);\n        })), (kvp) => kvp[0] !== \"true\")\n        .map(([hasSelectedEpStr, devices]) => {\n            const hasSelectedEp = hasSelectedEpStr === \"true\";\n            const label = hasSelectedEp ? \"Cluster found\" : \"Cluster not found\"\n            return <optgroup label={label}>{\n                devices.map(device => <option selected={device.nwkAddr === rule.DstNwkAddr} value={device.nwkAddr}>{getDeviceDisplayName(device)}</option>)\n            }</optgroup>\n        });\n\n        options.unshift(<option hidden>Select device</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onDstChange}\n            class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{options}</select>;\n    }\n\n\n    onClusterChange = (evt): void => {\n        const { onChange, rule, idx } = this.props;\n        const { value } = evt.target;\n        const [SrcEp, ClusterId] = value.split(\",\").map(p => parseInt(p, 10));\n        onChange && onChange(idx, { ...rule, SrcEp, ClusterId, DstNwkAddr: undefined });\n    };\n\n    renderClusterId(): ComponentChild {\n        const { device, rule } = this.props;\n        const optionGroups = Object.entries(device.ep ?? {}).map(([epNumber, ep]) => {\n            const clusters = Object.keys(ep.Out ?? {}).map(c => parseInt(c, 10));\n            return <optgroup label={`Endpoint: #${epNumber}`}>\n                {clusters.map(c => <option selected={c === rule.ClusterId && parseInt(epNumber, 10) == rule.SrcEp}\n                    value={[epNumber, c.toString()]}>{toHex(c, 4)}{getClusterName(c, true)}</option>)}\n            </optgroup>;\n        });\n        optionGroups.unshift(<option hidden>Select cluster</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onClusterChange}\n            class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{optionGroups}</select>;\n    }\n\n    onDstEpChange = (evt): void => {\n        const { onChange, rule, idx } = this.props;\n        const { value } = evt.target;\n        onChange && onChange(idx, { ...rule, DstEp: parseInt(value, 10) });\n    };\n\n    renderDstEp(): ComponentChild {\n        const { devices, rule } = this.props;\n        const dstDevice = devices.find((d) => d.nwkAddr === rule.DstNwkAddr);\n\n        let options = [];\n\n        if (dstDevice) {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const dstEndpoints = groupBy(Object.entries(dstDevice.ep ?? {}), ([epName, ep]) => Object.prototype.hasOwnProperty.call(ep.In ?? {}, rule.ClusterId));\n\n\n            options = options.concat(\n                sortBy(Object.entries(dstEndpoints), (kvp) => kvp[0] !== \"true\")\n                    .map(([has, endpoints]) =>\n                        <optgroup label={(has == \"true\" ? 'Cluster found' : \"Cluster not found\")}>\n                            {\n                                endpoints\n                                    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                                    .map(([epName, ep]) => <option\n                                        value={epName}\n                                        selected={parseInt(epName, 10) === rule.DstEp}>{epName}</option>)\n                            }\n                        </optgroup>));\n        }\n        options.unshift(<option hidden>Select destination</option>);\n\n        return <select disabled={this.isExistingBinding()} onChange={this.onDstEpChange}\n            class={cx(\"form-control\", { \"form-control-plaintext\": this.isExistingBinding() })}>{options}</select>;\n\n    }\n\n    onBindClick = (): void => {\n        const { onBindClick, rule } = this.props;\n        onBindClick && onBindClick(rule);\n    };\n    onUnBindClick = (): void => {\n        const { onUnBindClick, rule } = this.props;\n        onUnBindClick && onUnBindClick(rule);\n    };\n\n    renderActionButton(): ComponentChild {\n        const { rule } = this.props;\n        return (\n            this.isExistingBinding() ? (\n                <button onClick={this.onUnBindClick} type=\"button\" class=\"btn btn-danger w-100\">Unbind</button>\n            ) : (\n                    <button disabled={!isValidBindRule(rule)} onClick={this.onBindClick} type=\"button\"\n                        class=\"btn btn-primary w-100\">Bind</button>\n                )\n\n        );\n    }\n\n    render(): ComponentChild {\n        const { idx } = this.props;\n        return (\n            <tr>\n                <th scope=\"row\">{idx + 1}</th>\n                <td>{this.renderClusterId()}</td>\n                <td>{this.renderDstSelect()}</td>\n                <td>{this.renderDstEp()}</td>\n                <td>{this.renderActionButton()}</td>\n            </tr>\n        );\n    }\n}","import { Component, ComponentChild, h } from \"preact\";\n\nimport style from \"./style.css\";\nimport { genDeviceDetailsLink } from \"../../utils\";\nimport cx from \"classnames\";\nimport { TouchLinkDevice } from \"../../types\";\nimport Button from \"../button\";\nimport { Notyf } from \"notyf\";\n\ninterface DeviceCardProps {\n    device: TouchLinkDevice;\n    touchlinkIdentify(dev: string): Promise<void>;\n    touchlinkRest(dev: string): Promise<void>;\n}\n\nexport default class TouchlinkDeviceCard extends Component<DeviceCardProps, {}> {\n    onIdentifyClick = async (): Promise<void> => {\n        const { touchlinkIdentify, device } = this.props;\n        await touchlinkIdentify(device.ieeeAddr);\n        new Notyf().success(`Sent identify commant to ${device.ieeeAddr}`);\n    }\n\n    onResetClick = async (): Promise<void> => {\n        const { touchlinkRest, device } = this.props;\n        await touchlinkRest(device.ieeeAddr);\n        new Notyf().success(`Sent reset commant to ${device.ieeeAddr}`);\n    }\n    render(): ComponentChild {\n        const { device } = this.props;\n        return (\n            <div className={cx(\"card\", \"col-sm-4\", style[\"discovery-card\"], style[\"scale-in-center\"])}>\n                <div class=\"card-header\">\n                    Device <a href={genDeviceDetailsLink(device.ieeeAddr)}>{device.ieeeAddr}</a>\n                    <p class=\"card-text\"><small class=\"text-muted\">\n                        Discovered TouchLink device</small>\n                    </p>\n\n                </div>\n                <div className=\"card-body\">\n                    <div class={`row ${style[\"scale-in-center\"]}`}>\n                        <div class=\"col-5\">LinkQuality:</div>\n                        <div class=\"col\">{device.LinkQuality}</div>\n                    </div>\n                </div>\n                <div className=\"card-footer\">\n                    <div className=\"btn-group btn-group-sm\" role=\"group\">\n                        <Button<void> className=\"btn btn-success\" onClick={this.onIdentifyClick}>Identify</Button>\n                        <Button<void> className=\"btn btn-danger\" onClick={this.onResetClick}>Reset</Button>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { Dictionary } from \"../../types\";\nimport { ZigbeePayload } from \"./types\";\nimport DeviceCard from \"./device-card\";\nimport Button from \"../button\";\nimport { Notyf } from \"notyf\";\nimport orderBy from \"lodash/orderBy\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport WebsocketManager from \"../../websocket\";\nimport { getDeviceDisplayName } from \"../device-page/bind-row\";\nimport TouchlinkDeviceCard from \"./touchlink-device-card\";\nwindow[\"wsEventsData\"] = window[\"wsEventsData\"] || [];\nconst wsEventsData: object[] = window['wsEventsData'];\n\ninterface DiscoveryState {\n    targetRouter: string;\n    updateTimerId: number;\n    joinDuration: number;\n    events: Dictionary<ZigbeePayload[]>;\n}\n\nexport class Discovery extends Component<GlobalState & Actions, DiscoveryState> {\n    constructor() {\n        super();\n\n        this.state = {\n            targetRouter: '0x0000',\n            updateTimerId: 0,\n            joinDuration: 0,\n            events: {}\n        };\n\n    }\n\n    processZigbeeEvent = ({ category, payload }): void => {\n        wsEventsData.push({ category, payload })\n\n        const message = { ...payload };\n        // console.log(\"processZigbeeEvent\", message);\n        message.timestamp = Date.now();\n        const { events } = this.state;\n        const { ieeeAddr } = message;\n        let { joinDuration, updateTimerId } = this.state;\n        switch (message.event) {\n            case \"stateChange\":\n                break;\n            case \"PermitJoin\":\n                joinDuration = message.duration;\n                window.clearInterval(updateTimerId);\n                updateTimerId = window.setInterval(() => {\n                    const { joinDuration, updateTimerId } = this.state;\n                    if (joinDuration <= 0) {\n                        window.clearInterval(updateTimerId);\n                    } else {\n                        this.setState({ joinDuration: joinDuration - 1 });\n                    }\n\n                }, 1000);\n                break;\n            default:\n                if (events[ieeeAddr]) {\n                    events[ieeeAddr].push(message);\n                } else {\n                    events[ieeeAddr] = [message];\n                }\n                break;\n\n        }\n        this.setState({ events, joinDuration, updateTimerId });\n    }\n\n    componentDidMount(): void {\n        const { getZigbeeDevicesList } = this.props;\n        const manager = new WebsocketManager();\n        console.log(\"use `copy(wsEventsData)` to copy events log\");\n        manager.subscribe(\"zigbee\", this.processZigbeeEvent);\n        getZigbeeDevicesList(true);\n        setTimeout(() => this.enableJoin(), 500);\n    }\n    renderTLdevices(): ComponentChild {\n        const { touchlinkResuts, touchlinkRest, touchlinkIdentify } = this.props;\n        if (touchlinkResuts) {\n            return touchlinkResuts.devices.map(device => <TouchlinkDeviceCard\n                device={device}\n                touchlinkRest={touchlinkRest}\n                touchlinkIdentify={touchlinkIdentify}\n            />);\n        }\n        return null;\n    }\n    renderDevices(): ComponentChild {\n        const { startInterview } = this.props;\n        const { events } = this.state;\n        const sortedEvents = orderBy(Object.entries(events), ([_, events]) => events[0].timestamp).reverse();\n\n\n        return (<Fragment>\n            {this.renderJoinButton()}\n            <div className=\"row no-gutters\">\n                {this.renderTLdevices()}\n                {sortedEvents.map(([ieeeAddr, events]) => <DeviceCard startInterview={startInterview}\n                    ieeeAddr={ieeeAddr} events={events} />)}</div>\n        </Fragment>);\n\n    }\n\n    enableJoin = async (targetRouter = '0x0000'): Promise<void> => {\n        const { setJoinDuration } = this.props;\n        await setJoinDuration(255, targetRouter);\n        this.setState({ targetRouter });\n        new Notyf({ position: { x: \"left\", y: \"bottom\" } }).success(`Join enabled on ${targetRouter}`);\n    };\n    disableJoin = async (): Promise<void> => {\n        const { targetRouter } = this.state;\n        const { setJoinDuration } = this.props;\n        await setJoinDuration(0, targetRouter);\n        new Notyf({ position: { x: \"left\", y: \"bottom\" } }).success(\"Join disabled\");\n    };\n\n    renderJoinButton(): ComponentChild {\n        const { joinDuration } = this.state;\n        const { devices } = this.props;\n        const routers = devices.filter(d => d.type == \"Router\");\n        return (<div class=\"row h-100 justify-content-center align-items-center\">\n            {joinDuration <= 0 ? (\n                <div class=\"btn-group\">\n                    <Button<string> className=\"btn btn-success\" onClick={this.enableJoin} item={'0x0000'}>Enable\n                     join</Button>\n                    <button type=\"button\" class=\"btn btn-success dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                        <span class=\"sr-only\">Toggle</span>\n                    </button>\n                    <div class=\"dropdown-menu\">\n                        <a onClick={(): Promise<void> => this.enableJoin(\"\")} class=\"dropdown-item\" href=\"#\">All devices</a>\n                        {\n                            routers.map(router => <a onClick={(): Promise<void> => this.enableJoin(router.nwkAddr)} class=\"dropdown-item\" href=\"#\">{getDeviceDisplayName(router)}</a>)\n                        }\n                    </div>\n                </div>\n\n            ) : (<div>Join enabled for {joinDuration} seconds, <a href=\"#\" onClick={this.disableJoin}>Stop</a></div>)\n            }\n            {this.renderTlStartButton()}\n        </div>\n        );\n    }\n\n    renderEmptyScreen(): ComponentChild {\n        return (\n            <Fragment>\n                <div class=\"row h-100 justify-content-center align-items-center\">\n                    <h2>Nothing yet happened</h2>\n                </div>\n                {this.renderJoinButton()}\n            </Fragment>\n        );\n    }\n    fetchTlResults = async (): Promise<void> => {\n        const { touchlinkList, touchlinkResuts } = this.props;\n        if (!touchlinkResuts || touchlinkResuts.currentChannel !== 0) {\n            await touchlinkList();\n            setTimeout(this.fetchTlResults, 1000);\n        }\n\n    }\n    scanTL = async (): Promise<void> => {\n        const { touchlinkScan } = this.props;\n        await touchlinkScan();\n        await this.fetchTlResults();\n\n    }\n    renderTlStartButton(): ComponentChild {\n        const { touchlinkScanInProgress } = this.props;\n        return (\n        <span class=\"ml-5\">{touchlinkScanInProgress ? 'Scanning...' : <a href=\"#\" onClick={this.scanTL}>Scan TouchLink</a>}</span>\n        );\n    }\n\n    render(): ComponentChild {\n        const { touchlinkResuts } = this.props;\n        const { events } = this.state;\n        const hasAnyEvents = (Object.keys(events).length !== 0) || (touchlinkResuts && touchlinkResuts.devices.length > 0);\n        return <div class=\"container-fluid h-100\">{hasAnyEvents ? this.renderDevices() : this.renderEmptyScreen()}</div>\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"time\", \"devices\", \"touchlinkResuts\", \"touchlinkScanInProgress\"];\nconst ConnectedDiscovery = connect<{}, DiscoveryState, GlobalState, Actions>(mappedProps, actions)(Discovery);\nexport default ConnectedDiscovery;\n","import { Component, ComponentChild, createRef, h } from \"preact\";\nimport style from \"./style.css\";\nimport cx from \"classnames\";\nimport { Notyf } from \"notyf\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\nimport { connect } from \"unistore/preact\";\nimport { useEffect } from \"preact/hooks\";\n\nexport enum LogLevel {\n    LOG_OFF,\n    LOG_NORMAL,\n    LOG_VERBOSE,\n    LOG_DEBUG\n}\n\nexport interface LogViewerState {\n    followLog: boolean;\n}\n\nexport class LogViewer extends Component<GlobalState & Actions, LogViewerState> {\n    ref = createRef<HTMLDivElement>();\n\n    constructor() {\n        super();\n        this.state = {\n            followLog: true\n        };\n    }\n\n    async componentDidMount(): Promise<void> {\n        const { fetchLogsBuffer, getCurrentLogLevel } = this.props;\n        await fetchLogsBuffer();\n        setTimeout(this.scrollToBottom, 500);\n        await getCurrentLogLevel();\n    }\n\n\n    onFollowLogChange = (e: Event): void => {\n        e.preventDefault();\n        const { followLog } = this.state;\n        this.setState({ followLog: !followLog });\n    };\n\n    onClearScreenClick = (e: Event): void => {\n        const { clearLogs } = this.props;\n        clearLogs();\n    };\n    onClearCacheClick = async (e: Event): Promise<void> => {\n        const { clearLogsBuffer } = this.props;\n        await clearLogsBuffer();\n        new Notyf().success(\"Cache cleared\");\n    };\n\n    onLogLevelChange = async (e: Event): Promise<void> => {\n        const { setLogLevel, getCurrentLogLevel } = this.props;\n        const { value } = e.target as HTMLInputElement;\n        const logLevel = parseInt(value, 10);\n        await setLogLevel(logLevel);\n        getCurrentLogLevel();\n    };\n\n\n    scrollToBottom = (): void => {\n        this.ref.current.scrollTop = this.ref.current.scrollHeight;\n    };\n\n    render(): ComponentChild {\n        const { followLog } = this.state;\n        const { logLevel, logs } = this.props;\n\n        useEffect(() => {\n            followLog && this.scrollToBottom();\n        }, [followLog, logs.length]);\n\n        return (<div class=\"container-fluid h-100\">\n            <div class=\"row justify-content-around\">\n                <div class=\"col-sm-6 my-1\">\n                    <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n                        <button onClick={this.onClearScreenClick} type=\"button\" class=\"btn btn-secondary\">Clear screen\n                        </button>\n                        <button onClick={this.onClearCacheClick} type=\"button\" class=\"btn btn-danger\">Clear logs cache\n                        </button>\n                    </div>\n                </div>\n                <div class=\"col-sm-6 my-1\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-sm-4\">\n                            <select value={logLevel} class=\"custom-select\" onChange={this.onLogLevelChange}>\n                                <option value={LogLevel.LOG_OFF} selected>LOG_OFF</option>\n                                <option value={LogLevel.LOG_NORMAL} selected>LOG_NORMAL</option>\n                                <option value={LogLevel.LOG_VERBOSE}>LOG_VERBOSE</option>\n                                <option value={LogLevel.LOG_DEBUG}>LOG_DEBUG</option>\n                            </select>\n                        </div>\n                        <div class=\"col-sm2\">\n                            <div class=\"form-check form-check-inline\">\n                                <input checked={followLog} onChange={this.onFollowLogChange} class=\"form-check-input\"\n                                       type=\"checkbox\" id=\"followLog\" value=\"true\" />\n                                <label class=\"form-check-label\" for=\"followLog\">Follow log</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n\n            <div ref={this.ref} class={cx(\"h-100\", style[\"log-main\"])}>\n                {logs.map((line, lineNum) =>\n                    <div class={style[\"log-line\"]}>\n                        <a class={style[\"log-line-num\"]}>{lineNum + 1}</a>\n                        <span>{line}</span>\n                    </div>)}\n            </div>\n        </div>);\n    }\n}\n\nconst mappedProps = [\"logs\", \"logLevel\"];\nconst ConnectedLogViewer = connect<{}, LogViewerState, GlobalState, Actions>(mappedProps, actions)(LogViewer);\nexport default ConnectedLogViewer;","import { Component, ComponentChild, h } from \"preact\";\nimport styles from \"./style.css\";\n\nexport interface Named {\n    name: string;\n}\n\ninterface TreeViewProps<T extends Named> {\n    items: T[];\n\n    onItemClick(item: T): void;\n\n    onDeleteClick(item: T): void;\n}\n\ninterface FileLinkProps<T extends Named> {\n    items: T;\n\n    onClick(item: T): void;\n\n    onDeleteClick(item: T): void;\n}\n\nclass TreeItem<T extends Named> extends Component<FileLinkProps<T>, {}> {\n    onClick = (): void => {\n        const { onClick, items } = this.props;\n        onClick(items);\n    };\n    onDeleteClick = (): void => {\n        const { onDeleteClick, items } = this.props;\n        onDeleteClick(items);\n    };\n\n    render(): ComponentChild {\n        const { items } = this.props;\n        return <div class={`list-group-item list-group-item-action bg-light ${styles[\"file-link\"]}`}>\n            <a onClick={this.onClick} href={\"#\"}>{items.name}</a>\n            <i onClick={this.onDeleteClick} class=\"fa fa-trash\" />\n        </div>;\n    }\n}\n\nexport default class TreeView<T extends Named> extends Component<TreeViewProps<T>, {}> {\n    render(): ComponentChild {\n        const { items, onDeleteClick, onItemClick } = this.props;\n\n        return <div>\n            {items.map(file => (<TreeItem onDeleteClick={onDeleteClick} items={file} onClick={onItemClick} />))}\n        </div>;\n    }\n}","import { Component, createRef, h } from \"preact\";\nimport CM, { EditorFromTextArea } from \"codemirror\";\nimport { parse } from \"luaparse\";\ninterface CodeMirrorProps {\n    code: string;\n    height?: string;\n    width?: string;\n    config: CM.EditorConfiguration;\n\n    onChange?(value: string): void;\n}\n\nCM && CM.registerHelper('lint', 'lua', (text) => {\n    const found = [];\n    try {\n        const parseResult = parse(text);\n        console.log(parseResult);\n    } catch (e) {\n        found.push({\n            from: CM.Pos(e.line - 1, e.column),\n            to: CM.Pos(e.line- 1, e.index),\n            message: e.message});\n        console.error(e);\n    }\n    return found;\n});\n\n\nexport default class CodeMirror extends Component<CodeMirrorProps, {}> {\n    ref = createRef<HTMLTextAreaElement>();\n    codeMirror: EditorFromTextArea;\n\n    constructor() {\n        super();\n    }\n\n    codemirrorValueChanged = (doc, change) => {\n        const { onChange } = this.props;\n        if (onChange && change.origin !== \"setValue\") {\n            onChange(doc.getValue());\n        }\n    };\n\n    componentDidMount(): void {\n        const { current } = this.ref;\n        const { config, code, height, width } = this.props;\n        this.codeMirror = CM.fromTextArea(current, config);\n        this.codeMirror.on(\"change\", this.codemirrorValueChanged);\n        this.codeMirror.setValue(code);\n        this.codeMirror.setSize(width, height);\n\n    }\n\n    // eslint-disable-next-line react/no-deprecated\n    componentWillReceiveProps(nextProps: Readonly<CodeMirrorProps>, nextContext: any): void {\n        const { height, width, code, config } = nextProps;\n        const { code: currentCode } = this.props;\n        Object.entries(config).forEach(([name, value]) => {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            this.codeMirror.setOption(name, value);\n        });\n\n        this.codeMirror.setSize(width, height);\n        if (currentCode != code) {\n            const prevScrollPosition = this.codeMirror.getScrollInfo();\n            const prevCursor = this.codeMirror.getCursor();\n            this.codeMirror.setValue(code);\n            this.codeMirror.scrollTo(prevScrollPosition.left, prevScrollPosition.top);\n            this.codeMirror.setCursor(prevCursor);\n        }\n    }\n\n    render() {\n        return (\n            <textarea ref={this.ref} />\n        );\n    }\n}","import { Component, ComponentChild, Fragment, h } from \"preact\";\n\nimport style from \"./style.css\";\nimport cx from \"classnames\";\nimport TreeView from \"../tree-view\";\nimport CodeMirror from \"./codemirror\";\nimport { Dictionary, FileDescriptor } from \"../../types\";\nimport { Notyf } from \"notyf\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\nimport actions, { Actions } from \"../../actions\";\n\ninterface CodeEditorState {\n    sideBarIsVisible: boolean;\n}\n\nexport class CodeEditor extends Component<GlobalState & Actions, CodeEditorState> {\n    constructor() {\n        super();\n        this.state = {\n            sideBarIsVisible: true\n        };\n    }\n\n    onCodeChange = (code): void => {\n        const { setCurrentFileContent } = this.props;\n        setCurrentFileContent(code);\n    };\n\n    onExecuteCode = (): void => {\n        const { currentFileContent, evalCode } = this.props;\n        evalCode(currentFileContent).then();\n    };\n    onSaveCode = (): void => {\n        const { currentFile, currentFileContent, writeFile } = this.props;\n        writeFile(currentFile.name, currentFileContent).then(() => new Notyf().success(`Saved ${currentFile.name}`));\n    };\n\n\n    onCreateFile = async (): Promise<void> => {\n        const { writeFile } = this.props;\n        let fileName = prompt(\"Enter file name\");\n        if (fileName) {\n            if (!fileName.startsWith(\"/\")) {\n                fileName = `/${fileName}`;\n            }\n            await writeFile(fileName, \"\");\n            this.loadFiles(\"/\");\n        }\n    };\n\n    onDeleteClick = async (file: FileDescriptor): Promise<void> => {\n        const { deleteFile } = this.props;\n        if (confirm(`Delete ${file.name}?`)) {\n            await deleteFile(file);\n            this.loadFiles(\"/\");\n        }\n    };\n    loadFile = (file: FileDescriptor): void => {\n        const { readFile } = this.props;\n        readFile(file);\n    };\n\n\n    renderCodeExecutionResults(): ComponentChild {\n        const { executionResults } = this.props;\n\n        if (executionResults) {\n            return <div class={cx(\"h-24\", {\n                \"text-success\": executionResults.success,\n                \"text-danger\": !executionResults.success\n            })}>\n                Output:\n                <pre><code>{executionResults.result ?? \"NO RESPONSE\"}</code></pre>\n            </div>;\n        }\n        return null;\n\n    }\n\n    componentDidMount(): void {\n        this.loadFiles(\"/\");\n    }\n\n    loadFiles(path: string): void {\n        const { getFilesList } = this.props;\n        getFilesList(path);\n    }\n\n    toggleSideBar = (): void => {\n        const { sideBarIsVisible } = this.state;\n        this.setState({ sideBarIsVisible: !sideBarIsVisible });\n    };\n\n    getFileType(): string {\n        const fileExtPattern = /\\.([0-9a-z]+)$/i;\n        const { currentFile } = this.props;\n        if (currentFile) {\n            const { name } = currentFile;\n            if (fileExtPattern.test(name)) {\n                const [extWithDot, ext] = fileExtPattern.exec(name);\n                return ext;\n            }\n        }\n        return \"\";\n    }\n\n    onFormatClick = (): void => {\n        const { currentFileContent, setCurrentFileContent } = this.props;\n        if (this.getFileType() === \"json\") {\n            try {\n                const res = JSON.parse(currentFileContent);\n                setCurrentFileContent(JSON.stringify(res, null, 2));\n            } catch (e) {\n                new Notyf().error(e.toString());\n            }\n        } else {\n            new Notyf().error(\"Not implemented 😢\");\n        }\n    };\n\n    getMode(): string | Dictionary<string | boolean> {\n\n        switch (this.getFileType()) {\n            case \"json\":\n                return {\n                    name: \"javascript\",\n                    json: true\n                };\n            case \"script\":\n            case \"lua\":\n                return \"lua\";\n            default:\n                return \"\";\n        }\n\n    }\n\n    render(): ComponentChild {\n        const { sideBarIsVisible } = this.state;\n        const { currentFileContent, executionResults, files, currentFile, clearExecutionResults } = this.props;\n\n        const config = {\n            mode: this.getMode(),\n            theme: \"dracula\",\n            styleActiveLine: true,\n            lineNumbers: true,\n            lint: true,\n            gutters: [\"CodeMirror-lint-markers\"],\n            extraKeys: {\n                \"Ctrl-E\": this.onExecuteCode,\n                \"Cmd-E\": this.onExecuteCode,\n                \"Ctrl-S\": this.onSaveCode,\n                \"Cmd-S\": this.onSaveCode\n            }\n        };\n        const hasExecutionResults = !!executionResults;\n        const hasCode = currentFileContent && currentFileContent.length;\n\n\n        return (<div className={cx(\"h-100 px-0 d-flex\", style[\"code-editor\"])}>\n            <div class={cx(\"d-flex w-100\", style.wrapper, {\n                [style.toggled]: !sideBarIsVisible\n            })}>\n\n                <div class={cx(\"bg-light border-right position-relative\", style[\"sidebar-wrapper\"])}>\n                    <div class={style[\"sidebar-heading\"]}>Files</div>\n                    <div class=\"list-group list-group-flush\">\n\n                        <TreeView onItemClick={this.loadFile} onDeleteClick={this.onDeleteClick} items={files} />\n                        <button onClick={this.onCreateFile} type=\"button\"\n                            class={cx(\"btn\", \"btn-primary\", style[\"new-file\"])}>New file\n                        </button>\n                    </div>\n\n                </div>\n\n                <div class={style[\"page-content-wrapper\"]}>\n\n                    <nav class=\"navbar navbar-expand-lg navbar-light bg-light border-bottom\">\n                        <button onClick={this.toggleSideBar} class=\"btn btn-primary\">Toggle files</button>\n                        {currentFile ? <button type=\"button\" class=\"btn btn-success\"\n                            onClick={this.onSaveCode}>Save(Ctrl-S)</button> : null}\n                        {hasCode ? (\n                            <Fragment>\n                                <button type=\"button\" class=\"btn btn-danger\" onClick={this.onExecuteCode}>Run(Ctrl-E)\n                                </button>\n                                {\n                                    this.getFileType() === \"json\" ? (\n                                        <button type=\"button\" class=\"btn btn-primary\"\n                                            onClick={this.onFormatClick}>Format\n                                        </button>\n                                    ) : null\n                                }\n\n                            </Fragment>\n                        ) : null}\n                        {hasExecutionResults ?\n                            <button type=\"button\" class=\"btn btn-primary\" onClick={clearExecutionResults}>Clear\n                                output</button> : null}\n\n                        <div>\n                            {currentFile ? <input type=\"text\" placeholder={currentFile.name} readOnly /> : null}\n                        </div>\n                    </nav>\n\n\n                    <div class=\"h-75\">\n                        <div class={\"h-75\"}>\n                            <CodeMirror height={\"100%\"} width={\"100%\"} code={currentFileContent} config={config}\n                                onChange={this.onCodeChange} />\n                        </div>\n\n                        {this.renderCodeExecutionResults()}\n                    </div>\n                </div>\n            </div>\n        </div>);\n    }\n\n}\n\nconst mappedProps = [\"isLoading\", \"files\", \"executionResults\", \"currentFileContent\", \"currentFile\"];\nconst ConnectedCodeEditor = connect<{}, CodeEditorState, GlobalState, Actions>(mappedProps, actions)(CodeEditor);\nexport default ConnectedCodeEditor;\n","import { FunctionalComponent, h, RefObject } from \"preact\";\nimport { forwardRef } from \"preact/compat\";\n\n\ninterface UniversalEditorProps {\n    value: unknown;\n    onChange(value: unknown): void;\n    [k: string]: unknown;\n}\n\n\nconst UniversalEditor: FunctionalComponent<UniversalEditorProps> = forwardRef((props, ref: RefObject<HTMLInputElement>) => {\n    const { value, onChange, ...rest } = props;\n    const changeHandler = (event) => {\n        const { target } = event;\n        switch (target.type) {\n            case \"checkbox\":\n                onChange(target.checked);\n                break;\n            case \"number\":\n                target.valueAsNumber != value && onChange(target.valueAsNumber);\n                break;\n            default:\n                target.value != value && onChange(target.value);\n                break;\n        }\n    };\n    switch (typeof value) {\n        case \"boolean\":\n            return <input ref={ref} {...rest} type=\"checkbox\" checked={value} onChange={changeHandler}\n                          class=\"form-check-input\" />;\n        case \"number\":\n            return <input step=\"any\" ref={ref} {...rest} type=\"number\" value={value} onBlur={changeHandler} />;\n        default:\n            return <input ref={ref} {...rest} type=\"text\" value={value as string} onBlur={changeHandler} />;\n    }\n});\nexport default UniversalEditor;","import { Component, ComponentChild, h } from \"preact\";\nimport { Device, Dictionary } from \"../../types\";\nimport style from \"./style.css\";\nimport UniversalEditor from \"../universal-editor\";\nimport actions, { Actions } from \"../../actions\";\nimport { Notyf } from \"notyf\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\n\ninterface PropsFromStore {\n    device: Device | undefined;\n}\n\ntype DeviceParamTuple = [string, unknown];\n\n\nexport class SimpleBind extends Component<PropsFromStore & Actions, {}> {\n    setStateValue = async (name: string, value: unknown): Promise<void> => {\n        const { setStateValue, device, getDeviceInfo } = this.props;\n        await setStateValue(device.nwkAddr, name, value);\n        new Notyf().success(`Successfully updated state value ${name}=${value}`);\n        getDeviceInfo(device.nwkAddr);\n\n    };\n    setSimpleBind = async (name: string, value: unknown): Promise<void> => {\n        const { device, setSimpleBindValue, getDeviceInfo } = this.props;\n        await setSimpleBindValue(device.nwkAddr, name, value);\n        new Notyf().success(`Successfully updated simple bind value ${name}=${value}`);\n        getDeviceInfo(device.nwkAddr);\n    };\n\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderSimpleBinds();\n        }\n        return \"Loading...\";\n    }\n\n    refresh = async (name: string): Promise<void> => {\n        const { device, refreshState } = this.props;\n        await refreshState(device.nwkAddr, name);\n        new Notyf().success(`Requested state update ${device.nwkAddr} ${name}`);\n    }\n\n    renderSimpleBinds(): ComponentChild {\n        const { device } = this.props;\n        const simpleBindRules: Dictionary<string> = device.SB ?? {};\n\n        const kv = Object.entries(device.st ?? {});\n\n\n        return <table class=\"table table-striped table-borderless\">\n            <thead>\n                <tr>\n                    <th scope=\"col\" />\n                    <th scope=\"col\">Value</th>\n                    <th scope=\"col\">SB rule</th>\n                </tr>\n            </thead>\n            <tbody>\n                {kv.map((param: DeviceParamTuple) => (\n                    <tr class={style[\"props-row\"]}>\n                        <th scope=\"row\">{param[0]}</th>\n                        <td class={style[\"value-col\"]}>\n                            <UniversalEditor\n                                className=\"form-control-plaintext\"\n                                value={param[1]}\n                                onChange={(value): Promise<void> => this.setStateValue(param[0], value)}\n                            />\n                            <button type=\"button\" class={`btn ${style[\"refresh-btn\"]}`}><i class=\"fas fa-sync\" onClick={(): Promise<void> => this.refresh(param[0])} /></button>\n                        </td>\n                        <td>\n                            <UniversalEditor\n                                className=\"form-control form-control-plaintext\"\n                                value={simpleBindRules[param[0]] || \"\"}\n                                onChange={(value): Promise<void> => this.setSimpleBind(param[0], value)}\n                            />\n                        </td>\n                    </tr>\n                ))}\n            </tbody>\n        </table>;\n\n    }\n}\n\nconst mappedProps = [\"device\", \"forceRender\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps, actions)(SimpleBind);","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { Device } from \"../../types\";\nimport SafeImg from \"../safe-image\";\nimport { genDeviceDetailsLink, genDeviceImageUrl, toHex } from \"../../utils\";\nimport DeviceControlGroup from \"../device-control\";\nimport PowerSourceComp from \"../power-source\";\nimport style from \"./style.css\";\nimport { getClusterName } from \"./bind\";\nimport { connect } from \"unistore/preact\";\nimport { GlobalState } from \"../../store\";\n\ninterface PropsFromStore {\n    device: Device ;\n}\n\nexport class DeviceInfo extends Component<PropsFromStore, {}> {\n    render(): ComponentChild {\n        const { device } = this.props;\n        if (device) {\n            return this.renderDeviceInfo();\n        }\n        return \"Loading...\";\n    }\n\n    renderDeviceInfo(): ComponentChild {\n        const { device } = this.props;\n        const endpoints = Object.entries(device.ep ?? {}).map(([epName, ep]) => {\n            const inClusters = Object.entries(ep.In ?? {}).map(([clusterId]) => {\n                const cluster = parseInt(clusterId, 10);\n                return <small class={\"d-block text-nowrap text-truncate\"}\n                              title={toHex(cluster, 4)}>{getClusterName(cluster, false)}</small>;\n            });\n            const outClusters = Object.entries(ep.Out ?? {}).map(([clusterId]) => {\n                const cluster = parseInt(clusterId, 10);\n                return <small class={\"d-block text-nowrap text-truncate\"}\n                              title={toHex(cluster, 4)}>{getClusterName(cluster, false)}</small>;\n            });\n            return (<Fragment>\n                <dt class=\"col-5\">Endpoint #{epName}</dt>\n                <dl class={\"col-6\"} />\n\n                <dd class=\"col-5\">ProfileId</dd>\n                <dl class={\"col-7\"}>{ep.profId}</dl>\n\n                <dd class=\"col-5\">DeviceId</dd>\n                <dl class={\"col-7\"}>{ep.devId}</dl>\n\n                <dd class={\"col-5 text-nowrap\"}>Input clusters</dd>\n                <dl class=\"col-7\">{inClusters.length ? inClusters : <b>None</b>}</dl>\n                <dd class={\"col-5 text-nowrap\"}>Output clusters</dd>\n                <dl class=\"col-7\">{outClusters.length ? outClusters : <b>None</b>}</dl>\n\n            </Fragment>);\n        });\n        return (\n            <div class=\"card mb-3\">\n                <SafeImg class={`card-img-top ${style[\"device-pic\"]}`} src={genDeviceImageUrl(device)} />\n                <div class=\"card-body\">\n                    <h5 class=\"card-title\">{device.type}</h5>\n\n                    <dl class=\"row\">\n                        {\n                            device.friendly_name ? (\n                                <Fragment>\n                                    <dt class=\"col-5\">Friendly name</dt>\n                                    <dd class=\"col-7\">{device.friendly_name}</dd>\n                                </Fragment>\n                            ) : null\n                        }\n\n\n                        <dt class=\"col-5\">ieeeAddr</dt>\n                        <dd class=\"col-7\">{device.ieeeAddr}</dd>\n\n                        <dt class=\"col-5\">nwkAddr</dt>\n                        <dd class=\"col-7\">{device.nwkAddr}</dd>\n\n                        <dt class=\"col-5\">Power source</dt>\n                        <dd class=\"col-7\"><PowerSourceComp source={device.PowerSource}\n                                                           battery={device?.st?.battery} /></dd>\n\n                        <dt class=\"col-5\">ManufName</dt>\n                        <dd class=\"col-7\">{device.ManufName}</dd>\n\n                        <dt class=\"col-5\">ModelId</dt>\n                        <dd class=\"col-7\">{device.ModelId}</dd>\n\n\n\n                        <dt class=\"col-5\">Routes</dt>\n                        <dd class=\"col-7\">{device?.Rtg?.map((route) => <a className={\"d-block\"}\n                                                                          href={genDeviceDetailsLink(route)}>{route}</a>)}</dd>\n                        {endpoints}\n                    </dl>\n\n                </div>\n                <div class=\"card-footer\">\n                    <DeviceControlGroup device={device} />\n                </div>\n            </div>\n        );\n    }\n}\n\nconst mappedProps = [\"device\"];\n\nexport default connect<{}, {}, GlobalState, PropsFromStore>(mappedProps)(DeviceInfo);","import { Component, ComponentChild, h } from \"preact\";\nimport Bind from \"../device-page/bind\";\nimport cx from \"classnames\";\n\nexport interface TabInfo {\n    name: string;\n    TabComponent: ComponentChild;\n}\n\ninterface TabPanelProps {\n    tabs: TabInfo[];\n    defaultTab?: string;\n}\n\ninterface TabPanelState {\n    activeTab: string;\n}\n\ninterface TabLinkProps {\n    name: string;\n    isActive: boolean;\n\n    onClick(arg1: string): void;\n}\n\nexport class TabLink extends Component<TabLinkProps, {}> {\n    onClick = (): void => {\n        const { name, onClick } = this.props;\n        onClick(name);\n    };\n\n    render(): ComponentChild {\n        const { name, isActive } = this.props;\n        return <a onClick={this.onClick} class={cx(\"nav-link\", { active: isActive })} id={`${name}-tab`}\n                  data-toggle=\"tab\" href={`#${name}`} role=\"tab\" aria-controls={name} aria-selected=\"true\">{name}</a>;\n    }\n}\n\nexport default class TabPanel extends Component<TabPanelProps, TabPanelState> {\n    constructor() {\n        super();\n        this.state = {\n            activeTab: \"Bind\"\n        };\n    }\n\n    componentDidMount(): void {\n        this.initializeDefaultTab();\n    }\n\n    initializeDefaultTab(): void {\n        const { defaultTab } = this.props;\n        if (defaultTab) {\n            this.setState({ activeTab: defaultTab });\n        }\n    }\n\n    onTabLinkClick = (activeTab: string): void => {\n        this.setState({ activeTab });\n    };\n\n\n    render(): ComponentChild {\n        const { activeTab } = this.state;\n        const { tabs } = this.props;\n\n        return (<div>\n                <ul class=\"nav nav-tabs\">\n                    {\n                        tabs.map(({ name }) => (\n                            <li key={name} class=\"nav-item\">\n                                <TabLink name={name} isActive={name === activeTab} onClick={this.onTabLinkClick} />\n                            </li>\n                        ))\n                    }\n                </ul>\n                <div class=\"tab-content\">\n                    {\n                        tabs.map(({ name, TabComponent }) => (\n                            <div key={name} class={cx(\"tab-pane fade\", {\n                                \"show active\": activeTab === name\n                            })}>{TabComponent}</div>\n                        ))\n                    }\n                </div>\n            </div>\n        );\n    }\n}","import { Component, ComponentChild, h } from \"preact\";\nimport { connect } from \"unistore/preact\";\nimport actions, { Actions } from \"../../actions\";\nimport { GlobalState } from \"../../store\";\nimport SimpleBind from \"./simple-bind\";\nimport Bind from \"./bind\";\nimport DeviceInfo from \"./info\";\nimport TabPanel, { TabInfo } from \"../tab-panel\";\nimport style from \"./style.css\";\nimport WebsocketManager from \"../../websocket\";\n\ninterface DevicePageState {\n    dev: string;\n    activeTab: string;\n}\n\nexport class DevicePage extends Component<Actions & GlobalState, DevicePageState> {\n    constructor() {\n        super();\n        const { searchParams } = new URL(location.href);\n        const paramActiveTab = searchParams.get(\"activeTab\");\n        const deviceId = searchParams.get(\"dev\");\n        this.state = {\n            dev: deviceId,\n            activeTab: paramActiveTab ? paramActiveTab : \"Info\"\n        };\n    }\n\n    componentDidMount(): void {\n        this.initPage();\n    }\n\n\n\n    initPage(): void {\n        const { dev } = this.state;\n        const { getDeviceInfo, getZigbeeDevicesList, getDeviceBinds } = this.props;\n\n        getDeviceInfo(dev);\n        getDeviceBinds(dev);\n        getZigbeeDevicesList(true);\n    }\n\n    render(): ComponentChild {\n        const { isLoading, isError } = this.props;\n        const { activeTab } = this.state;\n\n        const tabs: TabInfo[] = [\n            {\n                name: \"Info\",\n                TabComponent: <DeviceInfo />\n            },\n            {\n                name: \"Bind\",\n                TabComponent: <Bind />\n            },\n            {\n                name: \"States\",\n                TabComponent: <SimpleBind />\n            }\n        ];\n        return (<div class={\"position-relative\"}>\n            {\n                isError ? <h1>{isError}</h1> : (\n                    isLoading ? (\n                        <div className={`${style.loader} spinner-grow text-primary`} role=\"status\">\n                            <span className=\"sr-only\">Loading...</span>\n                        </div>\n                    ) : null\n                )\n\n            }\n            <TabPanel defaultTab={activeTab} tabs={tabs} />\n        </div>);\n\n    }\n}\n\nconst mappedProps = [\"isLoading\", \"isError\", \"device\"];\nconst ConnectedDevicePage = connect<{}, DevicePageState, GlobalState, Actions>(mappedProps, actions)(DevicePage);\nexport default ConnectedDevicePage;","import createStore from \"unistore\";\nimport devtools from \"unistore/devtools\";\n\nimport { BindRule, Device, FileDescriptor, TouchLinkScanApiResponse } from \"./types\";\nimport { TimeInfo } from \"./components/discovery/types\";\nimport { LogLevel } from \"./components/log-viewer\";\nimport { ApiResponse } from \"./utils\";\n\n\nexport interface GlobalState {\n    forceRender: number;\n    isLoading: boolean;\n    isError: boolean | string;\n    device: Device | undefined;\n    devices: Device[];\n    bindRules: BindRule[];\n    time: TimeInfo | undefined;\n    logs: string[];\n    logLevel: LogLevel;\n\n\n    files: FileDescriptor[];\n    executionResults: ApiResponse<string> | null;\n\n    currentFileContent: string;\n    currentFile: FileDescriptor;\n\n\n    touchlinkResuts: TouchLinkScanApiResponse | null;\n    touchlinkScanInProgress: boolean;\n\n}\n\nconst initialState: GlobalState = {\n    forceRender: Date.now(),\n    device: undefined,\n    isLoading: false,\n    isError: false,\n    devices: [],\n    bindRules: [{} as BindRule],\n    time: undefined,\n    logs: [],\n    logLevel: LogLevel.LOG_DEBUG,\n\n\n    files: [],\n    executionResults: null,\n    currentFileContent: \"\",\n    currentFile: null,\n    touchlinkResuts: null,\n    touchlinkScanInProgress: false\n};\n\nconst store = process.env.NODE_ENV === 'production' ?  createStore(initialState) : devtools(createStore(initialState));\n\nexport default store;","/* eslint-disable @typescript-eslint/camelcase */\n// Must be the first import\n\n\n\n\nif (process.env.NODE_ENV === 'development') {\n    // Must use require here as import statements are only allowed\n    // to exist at the top of a file.\n    require(\"preact/debug\");\n\n}\n\n// const poly = require(\"preact-cli/lib/lib/webpack/polyfills\");\nimport \"notyf/notyf.min.css\";\n\nimport habitat from \"preact-habitat\";\nimport ConnectedMap from \"./components/map\";\nimport ConnectedZigbeeTable from \"./components/zigbee\";\nimport ConnectedDiscovery from \"./components/discovery\";\nimport ConnectedLogViewer from \"./components/log-viewer\";\nimport ConnectedCodeEditor from \"./components/code-editor\";\nimport ConnectedDevicePage from \"./components/device-page\";\nimport store from \"./store\";\nimport { Provider } from \"unistore/preact\";\nimport { h } from \"preact\";\nimport WebsocketManager from \"./websocket\";\n\n\ninterface StateChangePayload {\n    name: string;\n    value: string | number | boolean;\n    ieeeAddr: string;\n\n}\n\nconst applyStateChange = (data: StateChangePayload): void => {\n    const state = store.getState();\n\n    let { devices, forceRender } = state\n    const { device } = state;\n    const ts = Date.now() / 1000;\n    if (device && device.ieeeAddr === data.ieeeAddr) {\n        forceRender = ts;\n        device.st && (device.st[data.name] = data.value);\n        device.last_seen = ts;\n    }\n    devices = devices.map(d => {\n        if (d.ieeeAddr === data.ieeeAddr) {\n            forceRender = ts;\n            d.st && (d.st[data.name] = data.value);\n            d.last_seen = ts;\n        }\n        return d;\n    });\n    store.setState({ device, devices, forceRender });\n}\n\nconst processZigbeData = (data): void => {\n    const { event, ...payload } = data;\n    switch (event) {\n        case \"stateChange\":\n            applyStateChange(payload as StateChangePayload);\n            break;\n        default:\n            break;\n\n    }\n}\nconst processZigbeeEvent = ({ category, payload }): void => {\n    switch (category) {\n        case \"zigbee\":\n            processZigbeData(payload);\n            break;\n\n        default:\n            break;\n    }\n}\n\nconst manager = new WebsocketManager();\nconsole.log(\"use `copy(wsEventsData)` to copy events log\");\nmanager.subscribe(\"zigbee\", processZigbeeEvent);\n\n\n\n\nconst DevicePageApp = () => (\n    <Provider store={store}><ConnectedDevicePage /></Provider>\n);\nconst ZigbeeTableApp = () => (\n    <Provider store={store}><ConnectedZigbeeTable /></Provider>\n);\n\nconst MapApp = () => (\n    <Provider store={store}><ConnectedMap /></Provider>\n);\nconst DiscoveryApp = () => (\n    <Provider store={store}><ConnectedDiscovery /></Provider>\n);\nconst LogViewerApp = () => (\n    <Provider store={store}><ConnectedLogViewer /></Provider>\n);\nconst CodeEditorApp = () => (\n    <Provider store={store}><ConnectedCodeEditor /></Provider>\n);\n\nconst initWidgets = (): void => {\n    habitat(ZigbeeTableApp).render({\n        selector: \"[data-widget-host=\\\"zigbee\\\"]\",\n        clean: true\n    });\n\n    habitat(DevicePageApp).render({\n        selector: \"[data-widget-host=\\\"device-page\\\"]\",\n        clean: true\n    });\n\n    habitat(MapApp).render({\n        selector: \"[data-widget-host=\\\"map\\\"]\",\n        clean: true\n    });\n\n    habitat(DiscoveryApp).render({\n        selector: \"[data-widget-host=\\\"discovery\\\"]\",\n        clean: true\n    });\n    habitat(LogViewerApp).render({\n        selector: \"[data-widget-host=\\\"log-viewer\\\"]\",\n        clean: true\n    });\n\n    habitat(CodeEditorApp).render({\n        selector: \"[data-widget-host=\\\"code-editor\\\"]\",\n        clean: true\n    });\n\n\n};\ndocument.addEventListener(\"DOMContentLoaded\", initWidgets);","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tooltip\":\"_1rk7BV3JOGLq0LBsDwlTT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"plug\":\"_1rcBQvphkleKOfovl_Pvke\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dashed-link\":\"_1fFt3mhoAjHdI9KjdXwiJG\",\"value-col\":\"_39TL8GArlQw7aUWe8UA51_\",\"refresh-btn\":\"_3r5EggfiVRgwjKpPbblG7x\",\"props-row\":\"_2fm-PHIZ1vjSCIb2ZiDh9g\",\"device-pic\":\"_3TwJuuVA3A34CV1N2Vm57a\",\"loader\":\"_3X7MQ7DTf8-WnWd6NzQ0Ah\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"zigbee\":\"pyUw6XrDJwVDAd3O8540m\",\"actions\":\"gw3rbQq5ewCSIxGBpPmLW\",\"action-column\":\"_9SKic9U7zOc4ced8VnqrQ\",\"invisible\":\"xL9O5xYzyPwhLPC4mMolg\",\"adaptive\":\"_3muOVdl36jJiVia7saOlXF\",\"device-image\":\"_1iHkacKbhmIu3DVhNRYbcT\",\"nwk-addr\":\"EFe8Zugx_CKGG7nI77css\",\"ieee-addr\":\"_1GxvFsSniUTQeAfkPTn-cK\",\"manu-name\":\"_3hdFev3NLQTc3kbVCsXlHM\",\"device-pic\":\"_1mC0z2WyiQ2lZUxLOQpEt5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"device-image\":\"_1hcagYbY_Y6eeTNwa8vpcB\",\"scale-in-center\":\"_215Q2JzCNabshB1BCJTrhS\",\"blink\":\"_16C5lzFK8yu8gOeBQzvevo\"};","module.exports = window.luaparse;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"code-editor\":\"geoNa2kIUpUOXRRhXv41P\",\"new-file\":\"_3bamqu8MV-LdBWIqwXZF-m\",\"sidebar-wrapper\":\"_3W7vvcN5rn-Hks20WXtAxn\",\"sidebar-heading\":\"_3jzXMdkdqB1jZWSn8jJrxy\",\"page-content-wrapper\":\"_2b1ylNBPUCV70QwL8PCeVi\",\"wrapper\":\"_2iW__Y0Jv3LpP7xYpJL3Rn\",\"toggled\":\"_1QAgcfZ8fkCv8iLqfl7-tD\"};","module.exports = window.CodeMirror;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"file-link\":\"_1AT4Zc2jmRShgInKdjrlnt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"log-main\":\"_PTLkMdFkXUDWwzPaERqN\",\"log-line-num\":\"_3NyLFE6WWES_iOq0-i6PJP\",\"log-line\":\"t9x92HLE4CKZHxsr5l9VR\"};"],"sourceRoot":""}